<!DOCTYPE html> 			<html lang="en"> 				<head> 					<meta charset="UTF-8"> 					<title>Game Coder: Release Game</title> 					 				</head> 				<body> 				  <script>
function PointJS(ea,fa,jb,yc){this._logo="http://pointjs.ru/PjsMin.png";var g=window,q=this,Aa=!0,kb=!0,Hb=!0,ka=!1,Ba=!0,n=ea,p=fa,O=n/2,P=p/2,e={x:0,y:0},t={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"sans-serif",textBaseline:"top"},U=function(a){console.log("[PointJS] : ",a)};"undefined"!=typeof POINTJS_USER_LOG&&(U=POINTJS_USER_LOG);var Ma=function(a){var b=decodeURI(a.stack.toString().replace(/(@|[\(\)]|[\w]+:\/\/)/g,""));b=b.split(/\n/);b=(""==b[2]?b[0]:b[1]).split("/");b=b[b.length-
1].split(":");U('ERROR "'+a.toString()+'" \n in      '+b[0]+" \n line :   "+b[1]+" \n symbol : "+b[2])};this.game={};this.levels={};this.camera={};this.keyControl={};this.mouseControl={};this.touchControl={};this.actionControl={};this.system={};this.vector={};this.math={};this.layers={};this.colors={};this.brush={};this.audio={};this.wAudio={};this.resources={};this.tiles={};this.OOP={};this.memory={};this.zList={};this.system.log=U;this.system.consoleLog=function(a){this.log=!0===a?console.log:U};
this.system.setTitle=function(a){g.document.title=a};this.system.setSettings=function(a){Aa=u(a.isShowError)?a.isShowError:!0;kb=u(a.isStopForError)?a.isStopForError:!0;Hb=u(a.isAutoClear)?a.isAutoClear:!1;u(a.isZBuffer)};this.system.setDefaultSettings=function(a){for(var b in a)t[b]=a[b];h.save()};this.system.setSmoothing=function(a){Ba=a;h.msImageSmoothingEnabled=Ba;h.imageSmoothingEnabled=Ba};var mc={name:"PointJS",desc:"HTML5 Game Engine for JavaScript",author:"Skaner (skaner0@yandex.ru)",version:"0.2.1.0"};
this.system.getInfo=function(){return mc};var ba=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b},ha=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};ha.prototype={abs:function(){return new ha(Math.abs(this.x),Math.abs(this.y),Math.abs(this.z))},invert:function(){return new ha(-this.x,-this.y,-this.z)},plus:function(a){return new ha(this.x+a.x,this.y+a.y,this.z+a.z)},minus:function(a){return new ha(this.x-a.x,this.y-a.y,this.z-a.z)},inc:function(a){return new ha(this.x*
a.x,this.y*a.y,this.z*a.z)},div:function(a){return new ha(this.x/a.x,this.y/a.y,this.z/a.z)}};var f=function(a,b,c){return new ha(a,b,c)},B=function(a,b,c){return{w:a,h:b,d:c}},ta=function(a,b){return{x:a.x+b.x,y:a.y+b.y,z:a.z+b.z}},N=function(a,b,c){if(0!=c){var d=x(c);c=a.x-b.x;a=a.y-b.y;var l=Math.cos(d);d=Math.sin(d);return f(c*l-a*d+b.x,c*d+a*l+b.y)}return f(a.x,a.y)},Ca=function(a,b){return 180/Math.PI*Math.atan2(b.y-a.y,b.x-a.x)},la=function(a,b){var c,d=0;var l=0;var e=b.length;for(c=b.length-
1;l<e;c=l++)b[l].y>a.y!=b[c].y>a.y&&a.x<(b[c].x-b[l].x)*(a.y-b[l].y)/(b[c].y-b[l].y)+b[l].x&&(d=!d);return d};this.vector.point=f;this.vector.v2d=f;this.vector.size=B;this.vector.getPointAngle=N;this.vector.isPointIn=la;this.vector.pointMinus=function(a,b){return{x:a.x-b.x,y:a.y-b.y,z:a.z-b.z}};this.vector.pointPlus=ta;this.vector.pointInc=function(a,b){return{x:a.x*b.x,y:a.y*b.y,z:a.z*b.z}};this.vector.pointDiv=function(a,b){return{x:a.x/(0!=b.x?b.x:1),y:a.y/(0!=b.y?b.y:1),z:a.z/(0!=b.z?b.z:1)}};
this.vector.pointAbs=function(a){return{x:Math.abs(a.x),y:Math.abs(a.y),z:Math.abs(a.z)}};this.vector.getMidPoint=function(a,b){return u(b)?f((a.x+b.x)/2,(a.y+b.y)/2):0};this.vector.getDistance=function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))};this.vector.isSame=function(a,b){return u(b)?a.x==b.x&&a.y==b.y:!1};this.vector.getAngle2Points=Ca;this.vector.newStaticBox=function(a,b,c,d){return{x:a,y:b,w:a+c,h:b+d}};this.vector.newDynamicBoxRect=function(a,b,c,d){return[f(a,b),f(a+
c,b),f(a+c,b+d),f(a,b+d)]};this.vector.moveCollision=function(a,b,c,d){for(var l=f(c.x,c.y),e=0,h=b.length,g;e<h;e+=1)if(g=b[e],!(a.getDistanceC(g.getPositionC())>(g.w+g.h)/2+(a.w+a.h)/2)){var C=g.getStaticBox();if(a.isIntersect(g)){var k=a.getStaticBox(),m=Math.abs(c.x),n=Math.abs(c.y);k.x+k.w>C.x+10+m&&k.x<C.x+C.w-10-m&&(0<c.y&&k.y+k.h<C.y+C.h/2+n?l.y=0:0>c.y&&k.y>C.y+C.h-C.h/2-n&&(l.y=0));k.y+k.h>C.y+10+n&&k.y<C.y+C.h-10-n&&(0<c.x&&k.x+k.w<C.x+C.w/2+m?l.x=0:0>c.x&&k.x>C.x+C.w-C.w/2-m&&(l.x=0));
d&&d(a,g)}}a.move(l);return l};this.vector.moveCollisionAngle=function(a,b,c,d,l){var e=f();l=math.a2r(OOP.isDef(l)?l:a.angle);e.x=c*Math.cos(l);e.y=c*Math.sin(l);c=0;l=b.length;for(var h;c<l;c+=1)if(h=b[c],!(a.getDistanceC(h.getPositionC())>(h.w+h.h)/2+(a.w+a.h)/2)){var g=h.getStaticBox();if(a.isIntersect(h)){var k=a.getStaticBox(),m=Math.abs(e.x),n=Math.abs(e.y);k.x+k.w>g.x+10+m&&k.x<g.x+g.w-10-m&&(0<e.y&&k.y+k.h<g.y+g.h/2+n?e.y=0:0>e.y&&k.y>g.y+g.h-g.h/2-n&&(e.y=0));k.y+k.h>g.y+10+n&&k.y<g.y+g.h-
10-n&&(0<e.x&&k.x+k.w<g.x+g.w/2+m?e.x=0:0>e.x&&k.x>g.x+g.w-g.w/2-m&&(e.x=0));d&&d(a,h)}}a.move(e);return e};var Ib={},lb=function(){var a=(new Date).getTime();Ib[a]&&(a=lb());Ib[a]=!0;return a},x=function(a){return Math.PI/180*a},ca=function(a,b,c){var d=Math.floor(Math.random()*(b-a+1)+a);return c&&0==d?ca(a,b,c):d},mb=function(a){return 0>a?-1:1};this.math.limit=function(a,b){var c=mb(a);a=Math.abs(a);b=Math.abs(b);return a<b?a*c:b*c};this.math.sign=mb;this.math.a2r=x;this.math.random=ca;this.math.toInt=
function(a){return a>>0};this.math.uid=lb;this.math.toZiro=function(a,b){if(0==a)return 0;var c=mb(a);b=Math.abs(b);a=Math.abs(a);return 0<a&&(a-=b,a<b)?0:a*c};var Jb=function(a,b){return a?a:b?b:!1},nc=function(a,b){var c;this.canvas=c=g.document.createElement("canvas");var d=c.style,l=r.style;d.position="fixed";d.top=l.top;d.left=l.left;c.width=r.width;c.height=r.height;d.width=l.width;d.height=l.height;d.zIndex=l.zIndex+a;b&&(d.opacity=Jb(b.alpha,1),d.backgroundColor=Jb(b.backgroundColor,"transparent"));
m.attach(c);(this.context=c.getContext("2d")).textBaseline=t.textBaseline;this.isAutoClear=!0;this.clear=function(){this.context.clearRect(0,0,n,p)};this.on=function(a){h=this.context;this.isAutoClear&&this.clear();a(this);h=Kb}};this.layers.newLayer=function(a,b){return new nc(a,b)};var Lb=0,m={loaded:!1,events:{onload:[],preLoop:[],postLoop:[],gameBlur:[],gameFocus:[],gameResize:[]},addEvent:function(a,b,c){"onload"==a&&m.loaded?c():m.events[a].push({id:b,func:c})},delEvent:function(a,b){v(m.events[a],
function(a,d,l){a.id==b&&l.splice(d,1)})},runEvent:function(a){v(m.events[a],function(a){"function"==typeof a.func&&a.func()})},attach:function(a){var b=function(){g.document.body.appendChild(a)};m.loaded?b():m.addEvent("onload","attachElement_PointJS"+(Lb+=1),b)},remove:function(a){var b=function(){g.document.body.removeChild(a)};m.loaded?b():m.addEvent("onload","attachElement_PointJS"+(Lb+=1),b)},getWH:function(){return{w:parseInt(g.document.documentElement.clientWidth||g.innerWidth||g.document.body.clientWidth),
h:parseInt(g.document.documentElement.clientHeight||g.innerHeight||g.document.body.clientHeight)}}};this.system.delEvent=function(a,b){m.delEvent(a,b)};this.system.addEvent=function(a,b,c){m.addEvent(a,b,c)};this.system.removeDOM=function(a){m.remove(a)};this.system.attachDOM=function(a){m.attach(a)};this.system.newDOM=function(a,b){var c=g.document.createElement(a);c.style.position="fixed";c.style.left=0;c.style.top=0;c.style.zIndex=ma.style.zIndex+1;c.style.border="none";if(b){var d=function(a){a.stopPropagation()};
c.addEventListener("touchstart",d,!1);c.addEventListener("touchend",d,!1);c.addEventListener("touchmove",d,!1);c.addEventListener("mousedown",d,!1);c.addEventListener("mousepress",d,!1);c.addEventListener("mouseup",d,!1);c.addEventListener("mousemove",d,!1);c.addEventListener("keypress",d,!1);c.addEventListener("keydown",d,!1);c.addEventListener("keyup",d,!1);c.addEventListener("click",d,!1);c.addEventListener("wheel",d,!1);c.addEventListener("mousewheel",d,!1);c.addEventListener("contextmenu",d,
!1);c.addEventListener("selectstart",d,!1);c.addEventListener("dragstart",d,!1);c.addEventListener("DOMMouseScroll",d,!1)}m.attach(c);return c};var h=null,Kb=null;var r=g.document.createElement("canvas");Kb=h=r.getContext("2d");h.textBaseline=t.textBaseline;r.crossOrigin="anonymous";r.width=parseInt(ea);r.height=parseInt(fa);r.style.position="fixed";r.style.left=0;r.style.top=0;r.style.zIndex=1E4;r.id="PointJS-canvas_0";if("object"==typeof jb)for(var nb in jb)nb.match(/margin|padding|position/)||
(r.style[nb]=jb[nb]);m.addEvent("onload","Window_Hide_Scroll",function(){g.document.body.style.overflow="hidden";ob={x:parseInt(r.style.left),y:parseInt(r.style.top)}});var ma=g.document.createElement("div");(function(){var a=ma.style;a.position="fixed";a.top=a.left=0;a.width=a.height="100%";a.zIndex=2E4})();m.attach(ma);var ob=f(0,0);m.attach(r);this.system.setStyle=function(a){if("object"==typeof a)for(var b in a)r.style[b]=a[b]};this.system.getCanvas=function(){return r};this.system.getContext=
function(){return h};this.system.resize=function(a,b){n=a||ea;p=b||fa;O=n/2;P=p/2;r.width=n;r.height=p};this.system.initFullPage=function(){m.addEvent("gameResize","PointJS_resizeGame",function(){n=m.getWH().w;p=m.getWH().h;O=n/2;P=p/2;r.width=n;r.height=p;h.textBaseline=t.textBaseline});m.runEvent("gameResize","PointJS_resizeGame")};var V=!1,oc=function(){V||(this.requestFullscreen?(this.requestFullscreen(),V=!0):this.mozRequestFullScreen?(this.mozRequestFullScreen(),V=!0):this.webkitRequestFullscreen&&
(this.webkitRequestFullscreen(),V=!0),n=m.getWH().w,p=m.getWH().h,O=n/2,P=p/2,r.width=n,r.height=p)},pb=function(a){V=Mb(g.document.fullscreenElement||g.document.mozFullScreenElement||g.document.webkitFullscreenElement)};g.document.addEventListener("webkitfullscreenchange",pb);g.document.addEventListener("mozfullscreenchange",pb);g.document.addEventListener("fullscreenchange",pb);this.system.initFullScreen=function(){V||(g.document.documentElement.onclick=oc,Da||(m.addEvent("gameResize","PointJS_initFullScreen",
function(){n=m.getWH().w;p=m.getWH().h;O=n/2;P=p/2;r.width=n;r.height=p;h.textBaseline=t.textBaseline}),m.runEvent("gameResize","PointJS_initFullScreen")))};this.system.exitFullScreen=function(){V&&(m.delEvent("gameResize","PointJS_initFullScreen"),g.document.exitFullscreen?(g.document.exitFullscreen(),V=!1):g.document.mozCancelFullScreen?(g.document.mozCancelFullScreen(),V=!1):g.document.webkitExitFullscreen&&(g.document.webkitExitFullscreen(),V=!1),n=ea,p=fa,O=n/2,P=p/2,r.width=n,r.height=p,g.document.documentElement.onclick=
function(){})};this.system.isFullScreen=function(){return V};this.system.exitFullPage=function(){n=ea;p=fa;O=n/2;P=p/2;r.width=n;r.height=p};var X=!1,Da=!1,Nb=ea,Ob=fa,Pb=!1;this.system.initFullScale=function(a){Da||(a&&(Pb=!0),m.addEvent("gameResize","PointJS_initFullScale",function(){var a=Nb,c=Ob,d=m.getWH();Pb?(a=d.w,c=d.h):d.w<d.h?(c=d.w/n,a=d.w,c*=p):d.h<d.w&&(a=d.h/p,c=d.h,a*=n);Nb=a;Ob=c;X={w:a/n,h:c/p};r.style.width=a+"px";r.style.height=c+"px"}),m.runEvent("gameResize","PointJS_initFullScale"),
Da=!0)};this.system.exitFullScale=function(){Da&&(Da=!1,m.delEvent("gameResize","PointJS_initFullScale"),r.style.width=ea+"px",r.style.height=fa+"px")};this.system.getWH=function(){return m.getWH()};var D=!1;this.actionControl.initActionControl=function(){q.touchControl.isTouchSupported()&&(D=!0,q.touchControl.initTouchControl());q.mouseControl.initMouseControl();return this};this.actionControl.isPress=function(){return D?q.touchControl.isPress():q.mouseControl.isPress("LEFT")};this.actionControl.isDown=
function(){return D?q.touchControl.isDown():q.mouseControl.isDown("LEFT")};this.actionControl.isUp=function(){return D?q.touchControl.isUp():q.mouseControl.isUp("LEFT")};this.actionControl.isInObject=function(a){return D?q.touchControl.isInObject(a):q.mouseControl.isInObject(a)};this.actionControl.isInStatic=function(a){return D?q.touchControl.isInStatic(a):q.mouseControl.isInStatic(a)};this.actionControl.isInDynamic=function(a){return D?q.touchControl.isInDynamic(a):q.mouseControl.isInDynamic(a)};
this.actionControl.isPeekObject=function(a){return D?q.touchControl.isPeekObject(a):q.mouseControl.isPeekObject("LEFT",a)};this.actionControl.isPeekStatic=function(a){return D?q.touchControl.isPeekStatic(a):q.mouseControl.isPeekStatic("LEFT",a)};this.actionControl.isPeekDynamic=function(a){return D?q.touchControl.isPeekDynamic(a):q.mouseControl.isPeekDynamic("LEFT",a)};this.actionControl.getPosition=function(a){return D?q.touchControl.getPosition():q.mouseControl.getPosition()};this.actionControl.getPositionS=
function(a){return D?q.touchControl.getPositionS():q.mouseControl.getPositionS()};this.actionControl.getMouse=function(){return q.mouseControl};this.actionControl.getTouch=function(){return D?q.touchControl:!1};this.actionControl.getActiveControl=function(){return D?q.touchControl:q.mouseControl};this.actionControl.getActiveControlName=function(){return D?"touchControl":"mouseControl"};this.actionControl.getSpeed=function(){if(!D)return q.mouseControl.getSpeed()||q.touchControl.getSpeed()};var qb=
!1,Na={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123},ua={37:"LEFT",39:"RIGHT",38:"UP",40:"DOWN",32:"SPACE",17:"CTRL",16:"SHIFT",18:"ALT",27:"ESC",13:"ENTER",
189:"MINUS",187:"PLUS",20:"CAPS_LOCK",8:"BACKSPACE",9:"TAB",81:"Q",87:"W",69:"E",82:"R",84:"T",89:"Y",85:"U",73:"I",79:"O",80:"P",65:"A",83:"S",68:"D",70:"F",71:"G",72:"H",74:"J",75:"K",76:"L",90:"Z",88:"X",86:"V",66:"B",78:"N",77:"M",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",67:"C",57:"9",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12"},pc={8:!0,9:!0,13:!0,18:!0,16:!0,17:!0,27:!0,112:!0,113:!0,114:!0,115:!0,116:!0,
117:!0,118:!0,119:!0,120:!0,121:!0,122:!0,123:!0};this.keyControl.getKeyList=function(){var a,b=[];for(a in Na)b.push(a);return b};var Y={},Ea={},na={},Fa=!1,Ga=!1,Oa=!1,Pa=!1,qc=function(a){E(na,function(a,c,d){1==a&&(d[c]=2)})};this.keyControl.getCountKeysDown=function(){var a=0;E(Y,function(b,c){b&&a++});return a};this.keyControl.getAllKeysDown=function(){var a=[];E(Y,function(b,c){b&&a.push(ua[c])});return a};this.keyControl.getLastKeyPress=function(){return Pa?ua[Pa]:!1};this.keyControl.isDown=
function(a){return 1==Y[Na[a]]};this.keyControl.isUp=function(a){return 1==Ea[Na[a]]};this.keyControl.isPress=function(a){return 1==na[Na[a]]};this.keyControl.getInputChar=function(){return Fa};this.keyControl.getInputKey=function(){return ua[Ga]};this.keyControl.setInputMode=function(a){Oa=a};this.keyControl.isInputMode=function(){return Oa};this.keyControl.exitKeyControl=function(){g.onkeydown=function(){};g.onkeypress=function(){};g.onkeyup=function(){};y.clear("key:down");y.clear("key:press");
y.clear("key:up");m.delEvent("postLoop","PointJS_clearAllKeyUp");m.delEvent("preLoop","PointJS_KeyDownEvent");Y={};Ea={};na={};qb=Oa=Ga=Fa=!1};this.keyControl.initControl=this.keyControl.initKeyControl=function(){if(qb)return this;qb=!0;g.onkeydown=function(a){if(Oa)return Ga=a.keyCode,pc[a.keyCode]?(a.preventDefault(),!1):!0;a.preventDefault();2!=na[a.keyCode]&&(na[a.keyCode]=1,Pa=a.keyCode,y.run("key:press",ua[a.keyCode]));Y[a.keyCode]=!0;return!1};g.onkeypress=function(a){var b=!1;0!=a.which&&
0!=a.charCode&&32<=a.which&&(b=String.fromCharCode(a.which));Fa=b};g.onkeyup=function(a){a.preventDefault();1==Y[a.keyCode]&&(Ea[a.keyCode]=!0);Y[a.keyCode]=!1;y.run("key:up",ua[a.keyCode]);delete na[a.keyCode];delete Y[a.keyCode];return!1};m.addEvent("postLoop","PointJS_clearAllKeyUp",function(){Ea={};qc();Pa=Ga=Fa=!1});m.addEvent("preLoop","PointJS_KeyDownEvent",function(){y.isEvent("key:down")&&E(Y,function(a,b){a&&y.run("key:down",ua[b])})});return this};var rb=!1,F=f(0,0),Qa=f(0,0);f(0,0);var Ha=
!0,Ra="",Sa=!1,oa=f(0,0),Ta=!1,sb={LEFT:1,RIGHT:3,MIDDLE:2},tb={1:"LEFT",3:"RIGHT",2:"MIDDLE"},Ua=!1,Va={},Wa={},Ia={},va=0,Qb=function(){Va={};Wa={};Ia={};va=0;Ta=!1},rc=function(){E(Ia,function(a,b,c){1==a&&(c[b]=2)})},Xa=function(a){var b=0,c=0;a&&(b=e.x,c=e.y);return f(b+F.x,c+F.y)};this.mouseControl.getPosition=function(){return Xa(1)};this.mouseControl.getPositionS=function(){return Xa()};this.mouseControl.setCursorImage=function(a){a="url('"+a+"'), auto";Ra!=a&&(Ra=a,g.document.body.style.cursor=
Ra)};this.mouseControl.setVisible=function(a){!Ha&&!a||Ha&&a||(Ha=1==a,g.document.body.style.cursor=Ha?Ra:"none")};this.mouseControl.isVisible=function(){return Ha};this.mouseControl.isDown=function(a){return Va[sb[a]]};this.mouseControl.isUp=function(a){return Wa[sb[a]]};this.mouseControl.isPress=function(a){return 1==Ia[sb[a]]};this.mouseControl.isMove=function(){return Ta};this.mouseControl.isInStatic=function(a){var b=Xa(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isInDynamic=
function(a){return la(Xa(1),a)};this.mouseControl.isInObject=function(a){return a.visible?a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox()):!1};this.mouseControl.isWheel=function(a){return"UP"==a&&0<va||"DOWN"==a&&0>va};var Rb=function(a){a.preventDefault();va=a.wheelDelta?a.wheelDelta:-a.detail;y.run("mouse:wheel",0>va?"DOWN":"UP");return!1},Ya=!1,Sb=function(){Ya&&(Sa=u(g.document.pointerLockElement)||u(g.document.mozPointerLockElement)?!0:!1)};this.mouseControl.initMouseLock=
function(){m.addEvent("onload","initPointerLock",function(){Ya=ma.requestPointerLock||ma.mozRequestPointerLock||!1;g.document.exitPointerLock=g.document.exitPointerLock||g.document.mozExitPointerLock||!1;"onpointerlockchange"in g.document?g.document.addEventListener("pointerlockchange",Sb,!1):"onmozpointerlockchange"in g.document&&g.document.addEventListener("mozpointerlockchange",Sb,!1);if(!Ya)return U("error in initMouseLock : not supported");Sa||(ma.onclick=Ya)})};this.mouseControl.exitMouseLock=
function(){g.document.exitPointerLock();ma.onclick=function(){};oa=f(0,0)};this.mouseControl.unlockMouse=function(){oa=f(0,0);g.document.exitPointerLock()};this.mouseControl.isMouseLock=function(){return Sa};this.mouseControl.getSpeed=function(){return f(oa.x,oa.y)};this.mouseControl.isPeekStatic=function(a,b){return this.isPress(a)?this.isInStatic(b):!1};this.mouseControl.isPeekDynamic=function(a,b){return this.isPress(a)?this.isInDynamic(b):!1};this.mouseControl.isPeekObject=function(a,b){return this.isPress(a)&&
b.visible?this.isInDynamic(b.getDynamicBox()):!1};this.mouseControl.initControl=this.mouseControl.initMouseControl=function(){if(rb)return this;rb=!0;g.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(Sa){var b=a.movementY||a.mozMovementY||0;F.x+=a.movementX||a.mozMovementX||0;F.y+=b}else F.x=a.pageX-ob.x,F.y=a.pageY-ob.y,X&&(F.x/=X.w,F.y/=X.h);oa.x=F.x-Qa.x;oa.y=F.y-Qa.y;Qa.x=F.x;Qa.y=F.y;y.run("mouse:move");Ta=!0;return!1};g.onmousedown=function(a){a.preventDefault();a.stopPropagation();
!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));y.run("mouse:press",tb[a.which]);Ua=tb[a.which];Va[a.which]=!0;Ia[a.which]=1};g.onmouseup=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));y.run("mouse:up",tb[a.which]);Ua=!1;Va[a.which]=!1;Wa[a.which]=!0;delete Ia[a.which]};g.oncontextmenu=g.onselectstart=g.ondragstart=function(){return!1};g.onmousewheel=Rb;g.addEventListener("DOMMouseScroll",
Rb,!1);m.addEvent("preLoop","PointJS_MouseEventDown",function(){Ua&&y.run("mouse:down",Ua)});m.addEvent("postLoop","PointJS_clearAllMouseUp",function(){Wa={};rc();va=0;Ta=!1;oa=f(0,0)});return this};this.mouseControl.exitMouseControl=function(){y.clear("mouse:press");y.clear("mouse:down");y.clear("mouse:up");y.clear("mouse:move");y.clear("mouse:wheel");g.onmousemove=g.onmousedown=g.onmouseup=g.oncontextmenu=g.onselectstart=g.ondragstart=g.onmousewheel=function(){};m.delEvent("postLoop","PointJS_clearAllMouseUp");
m.delEvent("preLoop","PointJS_MouseEventDown");Qb();rb=!1};var ub=!1,Ja=!1,Za=0,$a=0,H=0,I=0,w=f(0,0),ab=[],Ka=f(0,0),bb=f(0,0);this.touchControl.isTouchSupported=function(){return!!("ontouchstart"in window)};this.touchControl.isMobileDevice=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(g.navigator.userAgent)};var Tb=function(){Ja=!1;$a=Za=0;w=f(0,0);ab=[];I=H=0};this.touchControl.getFixPositionS=function(){return w.x||w.y?f(w.x,w.y):!1};this.touchControl.getFixPosition=
function(){return w.x||w.y?f(w.x+e.x,w.y+e.y):!1};this.touchControl.getRun=function(){var a=0,b=0;w.x&&w.x!=H&&(a=H-w.x);w.y&&w.y!=I&&(b=I-w.y);return f(a,b)};this.touchControl.getVector=function(){var a=0,b=0;w.x&&w.x!=H&&(a=H>w.x?1:-1);w.y&&w.y!=I&&(b=I>w.y?1:-1);return f(a,b)};this.touchControl.getSpeed=function(){return f(Ka.x,Ka.y)};this.touchControl.isDown=function(){return Ja};this.touchControl.isPress=function(){return 1==Za};this.touchControl.isUp=function(){return 1==$a};this.touchControl.getPosition=
function(){return f(H+e.x,I+e.y)};this.touchControl.getPositionS=function(){return f(H,I)};this.touchControl.isPeekStatic=function(a){return this.isPress()?this.isInStatic(a):!1};this.touchControl.isPeekDynamic=function(a){return this.isPress()?this.isInDynamic(a):!1};this.touchControl.isPeekObject=function(a){return this.isPress()&&a.visible?this.isInDynamic(a.getDynamicBox()):!1};this.touchControl.isInStatic=function(a){var b=this.getPosition();return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+
a.h};this.touchControl.isInDynamic=function(a){return la(this.getPosition(),a)};this.touchControl.isInObject=function(a){return a.visible?a.angle?this.isInDynamic(a.getDynamicBox()):this.isInStatic(a.getStaticBox()):!1};this.touchControl.getTouches=function(){return ab};this.touchControl.initControl=this.touchControl.initTouchControl=function(){if(ub)return this;ub=!0;g.addEventListener("touchstart",function(a){a.preventDefault();H=a.targetTouches[0].pageX;I=a.targetTouches[0].pageY;ab=a.targetTouches;
X&&(H/=X.w,I/=X.h);y.run("touch:press");w.x=H;w.y=I;Ja=!0;Za=1;return!1},{passive:!1});g.addEventListener("touchmove",function(a){H=a.targetTouches[0].pageX;I=a.targetTouches[0].pageY;ab=a.targetTouches;X&&(H/=X.w,I/=X.h);Ka.x=H-bb.x;Ka.y=I-bb.y;y.run("touch:move");return!1},!1);g.addEventListener("touchend",function(a){w.x=0;w.y=0;Ja=!1;$a=1;y.run("touch:up");return!1},!1);q.touchControl.vibrate=function(a){if(g.navigator.vibrate)return g.navigator.vibrate(a);if(g.navigator.oVibrate)return g.navigator.oVibrate(a);
if(g.navigator.mozVibrate)return g.navigator.mozVibrate(a);if(g.navigator.webkitVibrate)return g.navigator.webkitVibrate(a)};m.addEvent("preLoop","PointJS_TouchDownEvent",function(){Ja&&y.run("touch:down")});m.addEvent("postLoop","PointJS_touchStopPress",function(){$a=Za=0;bb.x=H;bb.y=I;Ka=f(0,0)});return this};this.touchControl.exitTouchControl=function(){g.ontouchstart=g.ontouchmove=g.ontouchend=function(a){};m.delEvent("postLoop","PointJS_touchStopPress");m.delEvent("preLoop","PointJS_TouchDownEvent");
Tb();ub=!1};var cb=function(a,b,c,d){return"rgba("+a+", "+b+", "+c+", "+(d?d:1)+")"},Ub=function(a,b){a="#"==a[0]?a.substr(1,6):a;var c=parseInt(a.substr(0,2),16),d=parseInt(a.substr(2,2),16),l=parseInt(a.substr(4,2),16);return cb(c,d,l,b)};this.colors.rgb=function(a,b,c){return cb(a,b,c,1)};this.colors.rgba=function(a,b,c,d){return cb(a,b,c,d)};this.colors.hex2rgb=function(a){return Ub(a,1)};this.colors.hex2rgba=function(a,b){return Ub(a,b)};this.colors.randomColor=function(a,b,c){return cb(ca(a,
b),ca(a,b),ca(a,b),c||1)};var u=function(a){return"undefined"==typeof a||null==a?!1:!0},Mb=function(a){return u(a)&&""!==a&&0!==a?!0:!1},E=function(a,b){var c,d;for(c in a)if("undefined"!=typeof a[c]&&(d=b(a[c],c,a))&&"break"==d)break},v=function(a,b){if(a.length){var c,d;var l=0;for(c=a.length;l<c&&("undefined"==typeof a[l]||!(d=b(a[l],l,a,0<l?a[l-1]:a[a.length-1])||!1)||"break"!=d);l+=1);}};this.OOP.extractArrElement=function(a,b){var c=a[b];a.splice(b,1);return c};this.OOP.extractRandArrElement=
function(a){var b=ca(0,a.length-1),c=a[b];a.splice(b,1);return c};this.OOP.drawEach=function(a,b){E(a,function(a){a&&a.draw&&a.isInCamera()&&(a.draw(),b&&b(a))})};this.OOP.drawArr=function(a,b){var c;var d=0;for(c=a.length;d<c;d+=1)a[d]&&a[d].draw&&a[d].isInCamera()&&(a[d].draw(),b&&b(a[d],d))};var Vb=function(a){a.length=0},sc=function(a,b){var c=!1,d=lb(),l=!1,e=new XMLHttpRequest,f=function(){e.open("GET",a,!0);e.send()};e.onreadystatechange=function(){4==e.readyState&&(b(e.responseText),c&&(l?
setTimeout(f,l):f()))};this.start=function(){a=a.match(/\?/)?a+("&session_id="+d):a+("?session_id="+d);f();c=!0};this.setSID=function(a){d=a};this.setTime=function(a){l=a};this.stop=function(){c=!1};this.isActive=function(){return c}};this.OOP.readJSON=function(a,b){var c={},d=new XMLHttpRequest;d.open("GET",a,!0);z.add();d.onreadystatechange=function(){4==d.readyState&&(c=d.responseText,c=JSON.parse(c),z.load(),b(c))};d.send()};this.OOP.toString=function(a,b){var c,d=0,l="[";for(c in a)if(a.hasOwnProperty(c)){var e=
a[c];"number"==typeof e&&b&&(e=parseInt(e));l+=(0<d?", ":"")+c+" : "+e;d+=1}return l+"]"};this.OOP.sendGET=function(a,b,c){var d=new XMLHttpRequest,l="?";E(b,function(a,b){l+=b+"="+encodeURIComponent(a)+"&"});d.open("GET",a+l,!0);d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send()};this.OOP.sendPOST=function(a,b,c){var d=new XMLHttpRequest,l="";E(b,function(a,b){l+=b+"="+encodeURIComponent(a)+"&"});d.open("POST",a,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send(l)};this.OOP.sendPOSTScreen=function(a,b,c){var d=new XMLHttpRequest;b=b+"="+r.toDataURL("image/png");d.open("POST",a,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");d.onreadystatechange=function(){4==d.readyState&&c(d.responseText)};d.send(b)};this.OOP.isDef=u;this.OOP.isSet=Mb;this.OOP.forEach=E;this.OOP.forInt=function(a,b){var c,d;for(c=0;c<a&&(!(d=b(c))||"break"!=d);c+=1);};this.OOP.forXY=function(a,
b,c){var d,l,e;for(l=0;l<b;l+=1)for(d=0;d<a&&(!(e=c(d,l))||"break"!=e);d+=1);};this.OOP.forArr=v;this.OOP.clearArr=Vb;this.OOP.fillArr=function(a,b,c){a.length=0;var d;for(d=0;d<b;d+=1)a.push(c(d,0<d?a[d-1]:!1));return a};this.OOP.delObject=function(a,b){var c;var d=0;for(c=a.length;d<c;d+=1)if(a[d].id==b.id)return a.splice(d,1),!0};this.OOP.randArrElement=function(a){return a[ca(0,a.length-1)]};this.OOP.readJSONSync=function(a){var b=new XMLHttpRequest;b.open("GET",a,!1);b.send();a=b.responseText;
return a=JSON.parse(a)};this.OOP.sendGETSync=function(a,b){var c=new XMLHttpRequest,d="?";E(b,function(a,b){d+=b+"="+encodeURIComponent(a)+"&"});c.open("GET",a+d,!1);c.send();return c.responseText};this.OOP.sendPOSTSync=function(a,b){var c=new XMLHttpRequest,d="";E(b,function(a,b){d+=b+"="+encodeURIComponent(a)+"&"});c.open("POST",a,!1);c.setRequestHeader("Content-Type","application/x-www-form-urlencoded");c.send(d);return c.responseText};this.OOP.newAJAXListener=function(a,b){return new sc(a,b)};
this.OOP.runCode=function(a){(new Function("",a))()};var J={};this.OOP.includeSync=function(a,b){if(J[a])J[a].loaded&&!b&&J[a].code();else{J[a]={loaded:!1,code:function(){console.log(a+" is loading")}};var c=new XMLHttpRequest;c.open("GET",a,!1);c.send();J[a].code=new Function("",c.responseText);J[a].loaded=!0;J[a].code()}};this.OOP.include=function(a,b,c){if(J[a])J[a].loaded&&!c&&J[a].code(),b&&b();else{J[a]={loaded:!1,code:function(){console.log(a+" is loading")}};var d=new XMLHttpRequest;d.open("GET",
a,!0);d.onreadystatechange=function(){4==d.readyState&&(J[a].code=new Function("",d.responseText),J[a].loaded=!0,J[a].code(),b&&b())};d.send()}};this.OOP.clone=function(a,b){var c=Wb(a);E(a,function(a,b){-1===["id","type"].indexOf(b)&&(c[b]=a)});b&&(c.onClone=b,c.onClone(c),delete c.onClone);return c};var wa=60,K=Date.now(),db=0,eb=-1,Xb=K,ia={},fb=0;this.game.setFPS=function(a){wa=0<a?a:60};this.game.getFPS=function(){return wa};this.game.getDT=function(a){a||(a=1E3);return db/a};this.game.getTime=
function(){return K};var Yb=function(){return g.requestAnimationFrame||g.webkitRequestAnimationFrame||g.mozRequestAnimationFrame||g.oRequestAnimationFrame||g.msRequestAnimationFrame||function(a){g.setTimeout(a,1E3/wa)}},xa=Yb(),Zb=function(){K=Date.now();Hb&&h.clearRect(0,0,n,p);m.runEvent("preLoop")},$b=function(){m.runEvent("postLoop");-1!=eb&&(db=K-eb);eb=K},L={func:function(){console.log('please, use a "setLoop" function.');xa=function(){}},events:!1,start:!1,end:!1,audio:!1,fps:!1,name:"NotLoop"},
ac=function(){L.audio&&v(L.audio,function(a){a.stop()})};this.game.newLoop=function(a,b,c,d,l){"function"==typeof b?ia[a]={events:l||!1,func:b,start:c||!1,end:d||!1,audio:!1,fps:!1,name:a}:ja("error in newLoop : "+b+" is not a function")};this.game.newLoopFromClassObject=function(a,b){if(!b.update)return ja('error in newLoopFromClassObject : function "update" not found');ia[a]={events:b.events||!1,func:b.update,start:b.entry||!1,end:b.exit||!1,audio:!1,fps:!1,name:a}};this.game.newLoopFromConstructor=
function(a,b){q.game.newLoopFromClassObject(a,new b)};this.game.setLoopSound=function(a,b){var c;ia[a].audio||(ia[a].audio=[]);for(c=0;c<b.length;c+=1)ia[a].audio.length=0,b[c].setNextPlay(b[c+1==b.length?0:c+1]),ia[a].audio.push(b[c])};this.game.setLoop=function(a){if(!ia[a])return ja("setLoop : "+a+" is no a Loop");ac();Qb();Y={};Ea={};na={};Ga=Fa=!1;Tb();vb(f(0,0));L.end&&L.end();L=ia[a];y.loadFromEvents(L.events);L.start&&L.start();L.audio&&L.audio[0].play()};var y=new function(){var a={"mouse:click":[]},
b=this;this.add=function(b,d){a[b]||(a[b]=[]);a[b].push(d)};this.run=function(b,d){a[b]&&v(a[b],function(a){return a(d)})};this.clear=function(b){a[b]&&(a[b].length=0)};this.clearAll=function(){E(a,function(a){a.length=0})};this.loadFromEvents=function(a){b.clearAll();a&&E(a,function(a,c){b.add(c,a)})};this.isEvent=function(b){return!!a[b]}};this.game.tick=function(a,b){fb==a&&b()};var gb={};this.game.skip=function(a,b,c){u(gb[a])||(gb[a]=0);gb[a]++>=b&&(c(),gb[a]=0)};var wb=function(){60>fb?fb++:
fb=0;if(60>wa){var a=1E3/wa;try{K=Date.now(),K-Xb>a&&(Zb(),L.func(db),Xb=K,$b())}catch(b){Aa&&Ma(b),kb&&(Aa||Ma(b),ja())}xa(wb);return!1}try{Zb(),L.func(db),$b()}catch(b){Aa&&Ma(b),kb&&(Aa||Ma(b),ja())}xa(wb)},bc=function(a){ka||(ka=!0,wa=a||60,xa(wb))},ja=function(a){if(!ka)return U(u(a)?a:"game is stop");ka=!1;ac();xa=function(){U(u(a)?a:"game is stop")}};this.game.getWH=function(){return{w:n,h:p,w2:O,h2:P}};this.game.getWH2=function(){return{w:n/2,h:p/2}};this.game.getResolution=function(){return Math.min(n/
ea,p/fa)};this.game.startLoop=function(a,b){this.setLoop(a);this.start(b)};this.game.start=bc;this.game.stop=ja;this.game.resume=function(a){if(!ka)return L.audio&&L.audio[0].play(),U(a||"game is run"),xa=Yb(),eb=-1,bc(),!1};var tc=[],uc=0,A=function(a){this.type="BaseObject";this.id=uc+=1;this.x=a.x||0;this.y=a.y||0;this.w=a.w||0;this.h=a.h||0;this.ondraw=a.ondraw?a.ondraw:!1;this.parent=!1;this.children=[];this.fillColor=a.fillColor||!1;this.strokeColor=a.strokeColor||t.strokeStyle;this.strokeWidth=
a.strokeWidth||0;this.angle=a.angle||0;this.alpha=u(a.alpha)?a.alpha:1;this.center=f(0,0);this.box={x:0,y:0,w:0,h:0};this.visible=u(a.visible)?a.visible:!0;this.flip=f(0,0);this.setShadow(a);a.userData&&this.setUserData(a.userData);a.center&&this.setCenter(a.center);a.box&&this.setBox(a.box);a.size&&this.setSize(a.size);a.sizeC&&this.setSizeC(a.sizeC);a.position&&this.setPosition(a.position);a.positionC&&this.setPositionC(a.positionC);"function"==typeof a.oncreate&&(this.oncreate=a.oncreate,this.oncreate(),
delete this.oncreate);tc.push(this)};A.prototype={getID:function(){return this.id},getType:function(){return this.type},getParent:function(){return this.parent},addChild:function(a){a&&a.id!=this.id&&(a.parent=this,this.children.push(a),a.move(this.getPosition()),a.setPositionC(N(a.getPositionC(),this.getPositionC(),this.angle)),a.turn(this.angle))},delChild:function(a){a.parent=!1;var b;var c=0;for(b=this.children.length;c<b;c+=1)if(this.children[c].id==a.id){this.children.splice(c,1);break}},delParent:function(){this.parent.delChild(this)},
setBox:function(a){a.offset&&(this.box.x=a.offset.x||0,this.box.y=a.offset.y||0);a.size&&(this.box.w=a.size.w||0,this.box.h=a.size.h||0)},isArrIntersect:function(a){var b;var c=0;for(b=a.length;c<b;c+=1)if(a[c].id!=this.id&&this.isIntersect(a[c]))return a[c];return!1},isArrInside:function(a){var b;var c=0;for(b=a.length;c<b;c+=1)if(this.isDynamicInside(a[c].getDynamicBox()))return a[c];return!1},getNearest:function(a){var b=0,c=!1,d;var e=0;for(d=a.length;e<d;e+=1)if(this.id!=a[e].id){!1===c&&(c=
this.getDistanceC(a[e].getPositionC()),b=e);var f=this.getDistanceC(a[e].getPositionC());f<c&&(c=f,b=e)}return a[b]},setFlip:function(a,b){u(a)&&this.flip.x!=a&&(this.flip.x=a);u(b)&&this.flip.y!=b&&(this.flip.y=b)},setUserData:function(a){for(var b in a)u(this[b])||(this[b]=a[b])},setShadow:function(a){this.shadowColor=a.shadowColor||!1;this.shadowBlur=u(a.shadowBlur)?a.shadowBlur:3;this.shadowX=a.shadowX||0;this.shadowY=a.shadowY||0},getDynamicBox:function(){var a=this.getPosition(1);return 0==
this.angle?[f(this.x+this.box.x,this.y+this.box.y),f(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),f(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),f(this.x+this.box.x,this.y+this.box.y+this.h+this.box.h)]:[N(f(this.x+this.box.x,this.y+this.box.y),a,this.getAngle()),N(f(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y),a,this.getAngle()),N(f(this.x+this.box.x+this.w+this.box.w,this.y+this.box.y+this.h+this.box.h),a,this.getAngle()),N(f(this.x+this.box.x,this.y+
this.box.y+this.h+this.box.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),c;var d=0;for(c=b.length;d<c;d+=1)if(la(b[d],a))return!0;d=0;for(c=a.length;d<c;d+=1)if(la(a[d],b))return!0;return!1},isIntersect:function(a){return a.visible?this.angle||a.angle?this.isDynamicIntersect(a.getDynamicBox()):this.isStaticIntersect(a.getStaticBox()):!1},isDynamicInside:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),c,d=0;var e=0;for(c=b.length;e<
c;e+=1)la(b[e],a)&&(d+=1);return d==b.length?!0:!1},drawDynamicBox:function(a){M(this,1);h.shadowColor="transparent";ya(f(this.x+this.box.x,this.y+this.box.y),B(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);cc(f(this.x+this.w/2+this.center.x,this.y+this.h/2+this.center.y),10,a||"yellow");G()},drawStaticBox:function(a){h.shadowColor="transparent";ya(f(this.x+this.box.x,this.y+this.box.y),B(this.w+this.box.w,this.h+this.box.h),!1,a||"yellow",2);cc(f(this.x+this.w/2+this.center.x,this.y+this.h/
2+this.center.y),10,a||"yellow")},isStaticIntersect:function(a){return this.y+this.box.y+this.h+this.box.h>=a.y&&this.x+this.box.x+this.w+this.box.w>=a.x&&this.x+this.box.x<a.x+a.w&&this.y+this.box.y<a.y+a.h},getStaticBox:function(){return{x:this.x+this.box.x,y:this.y+this.box.y,w:this.w+this.box.w,h:this.h+this.box.h}},setAlpha:function(a){this.alpha!=a&&(this.alpha=0<=a?1>=a?a:1:0)},transparent:function(a){this.setAlpha(this.alpha+a)},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-
this.getPosition(1).y,a.x-this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=f(a.x,a.y)},nullCenter:function(a){a||(a=f(0,0));this.center=f(-this.w/2+a.x,-this.h/2+a.y)},getCenter:function(){return f(this.center.x,this.center.y)},getBox:function(){return this.box},move:function(a){this.prevPosition=this.getPosition();this.x+=a.x;this.y+=a.y},circling:function(a,b,c){u(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.x=a.x+b*Math.cos(x(this.circlingAnglePointJS));
this.y=a.y+b*Math.sin(x(this.circlingAnglePointJS));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},circlingC:function(a,b,c){u(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.setPositionC(f(a.x+b*Math.cos(x(this.circlingAnglePointJS)),a.y+b*Math.sin(x(this.circlingAnglePointJS))));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+c},motion:function(a,b,c){u(this.motionPercentPointJS)||(this.motionPercentPointJS=
0);this.x=a.x+b.w*Math.cos(x(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(x(this.motionPercentPointJS));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},motionC:function(a,b,c){u(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.setPositionC(f(a.x+b.w*Math.cos(x(this.motionPercentPointJS)),a.y+b.h*Math.sin(x(this.motionPercentPointJS))));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+c},scale:function(a){this.w*=
a;this.h*=a},scaleC:function(a){var b=this.w,c=this.h;this.scale(a);this.move(f(-((this.w-b)/2),-((this.h-c)/2)))},getPosition:function(a){return 1==a?f(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):2==a?(a=f(this.x+this.w/2,this.y+this.h/2),this.angle&&(a=N(a,this.getPosition(1),this.angle)),f(a.x,a.y)):f(this.x,this.y)},getPositionC:function(){return f(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y))},getPositionS:function(){return f(this.x+e.x,this.y+e.x)},getPositionCS:function(){return f(this.x+
(this.w/2+this.center.x)+e.x,this.y+(this.h/2+this.center.y)+e.y)},setPosition:function(a){this.getPosition();!1!==a.x&&(this.x=a.x);!1!==a.y&&(this.y=a.y)},setPositionS:function(a){this.getPosition();!1!==a.x&&(this.x=a.x+e.x);!1!==a.y&&(this.y=a.y+e.y)},setPositionC:function(a){this.getPosition();!1!==a.x&&(this.x=-(this.w/2+this.center.x)+a.x);!1!==a.y&&(this.y=-(this.h/2+this.center.y)+a.y)},setPositionCS:function(a){this.getPosition();!1!==a.x&&(this.x=-(this.w/2+this.center.x)+a.x+e.x);!1!==
a.y&&(this.y=-(this.h/2+this.center.y)+a.y+e.y)},getSize:function(){return B(this.w,this.h)},setSize:function(a){this.w=a.w;this.h=a.h},setSizeC:function(a){this.w=a.w;this.h=a.h;this.move(f(-(a.w/2),-(a.h/2)))},turn:function(a){this.angle+=a},rotateForAngle:function(a,b){0>this.angle&&(this.angle+=360);0>a&&(a+=360);var c=this.angle-a;180<c?c-=360:-180>c&&(c+=360);c>=-b-.5&&c<=b+.5?this.angle=a:c>b+.5?this.angle-=b:c<-b-.5&&(this.angle+=b)},rotateForPoint:function(a,b){var c=Ca(this.getPositionC(),
a);this.rotateForAngle(c,b)},rotateForObject:function(a,b){var c=Ca(this.getPositionC(),a.getPositionC());this.rotateForAngle(c,b)},moveTo:function(a,b){var c=x(Ca(this.getPosition(),a));this.prevPosition=this.getPosition();this.x+=b*Math.cos(c);this.y+=b*Math.sin(c)},moveToC:function(a,b){var c=x(Ca(this.getPositionC(),a));this.prevPosition=this.getPosition();this.x+=b*Math.cos(c);this.y+=b*Math.sin(c)},moveAngle:function(a,b){b=x(u(b)?b:this.angle);this.prevPosition=this.getPosition();this.x+=a*
Math.cos(b);this.y+=a*Math.sin(b)},moveTime:function(a,b){b=b||1;var c=this.getPosition();this.move(f((a.x-c.x)/b,(a.y-c.y)/b))},moveTimeC:function(a,b){b=b||1;var c=this.getPosition(1);this.move(f((a.x-c.x)/b,(a.y-c.y)/b))},getAngle:function(){return this.angle},setAngle:function(a){this.angle!=a&&(this.angle=a%360)},getDistance:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(1).x,
2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=1==a},isVisible:function(){return this.visible},isInCamera:function(){return this.angle?this.isInCameraDynamic():this.isInCameraStatic()},isInCameraStatic:function(){return this.x+this.w<e.x||this.x>e.x+n||this.y+this.h<e.y||this.y>e.y+p?!1:!0},isInCameraDynamic:function(){var a=this.getDynamicBox(),b=[f(e.x,e.y),f(e.x+n,e.y),f(e.x+n,e.y+p),f(e.x,e.y+p)],c,d=0;var l=0;for(c=a.length;l<c;l+=1)la(a[l],b)&&(d+=1);return 0<
d},draw:function(){}};this.game.newBaseObject=function(a){return new A(a)};var xb=function(a){A.call(this,a);this.type="TriangleObject"};ba(A,xb);xb.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;La(this.x,this.y,[f(this.w/2,0),f(this.w,this.h),f(0,this.h)],this.fillColor,this.strokeWidth?this.strokeColor:!1,this.strokeWidth);if(this.ondraw)this.ondraw();a&&G()}};this.game.newTriangleObject=function(a){return new xb(a)};
var yb=function(a){A.call(this,a);this.type="RectObject"};ba(A,yb);yb.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;ya(f(this.x,this.y),B(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);if(this.ondraw)this.ondraw();a&&G()}};this.game.newRectObject=function(a){return new yb(a)};var zb=function(a){A.call(this,a);this.type="RoundRectObject";this.radius=a.radius||1};ba(A,zb);zb.prototype.draw=function(){if(this.visible&&
this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;Ab(f(this.x,this.y),B(this.w,this.h),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);if(this.ondraw)this.ondraw();a&&G()}};this.game.newRoundRectObject=function(a){return new zb(a)};var pa=function(a){A.call(this,a);this.radius=a.radius||5;a.scale&&(this.radius*=a.scale);this.w=2*this.radius;this.h=2*this.radius;this.type="CircleObject";a.positionC&&this.setPositionC(a.positionC)};ba(A,pa);pa.prototype.draw=
function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;za(f(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);if(this.ondraw)this.ondraw();a&&G()}};pa.prototype.scale=function(a){this.w*=a||0;this.h*=a||0;this.radius*=a?a/2:0};pa.prototype.scaleC=function(a){var b=this.w,c=this.h;this.w*=a||0;this.h*=a||0;this.radius*=a;this.move(f(-((this.w-b)/2),-((this.h-c)/2)))};pa.prototype.getRadius=function(){return this.radius};
pa.prototype.setRadius=function(a){a&&this.radius!=a&&(this.radius=a,this.w=2*a,this.h=2*a)};this.game.newCircleObject=function(a){return new pa(a)};var Bb=function(a){this.file=a.file;this.w=a.w;this.h=a.h;this.read={x:0,y:0,w:0,h:0};a.read&&(this.read.w=a.read.w||0,this.read.h=a.read.h||0,this.read.x=a.read.x||0,this.read.y=a.read.y||0);this.countX=a.countX;this.countY=a.countY;this.fullW=this.countX*this.w;this.fullH=this.countY*this.h;this.cnv=g.document.createElement("canvas");this.cnv.width=
this.w;this.cnv.height=this.h;this.ctx=this.cnv.getContext("2d");this.loaded=!1;this.x=a.x||0;this.y=a.y||0;a=g.document.createElement("img");var b=this;a.onload=function(){b.ctx.drawImage(this,b.read.x?b.read.x:0,b.read.y?b.read.y:0,b.read.w?b.read.w:this.width,b.read.h?b.read.h:this.height,0,0,b.w,b.h);b.loaded=!0;z.load()};a.src=this.file;z.add()};Bb.prototype.draw=function(){if(this.loaded){var a=-e.x+this.x,b=-e.y+this.y,c,d;for(d=0;d<this.countY;d+=1)if(!(this.y+d*this.h+this.h<e.y||this.y+
d*this.h>e.y+p))for(c=0;c<this.countX;c+=1)this.x+c*this.w+this.w<e.x||this.x+c*this.w>e.x+n||h.drawImage(this.cnv,a+c*this.w,b+d*this.h,this.w,this.h)}};Bb.prototype.getSize=function(){return this.loaded?B(this.fullW,this.fullH):B()};this.game.newBackgroundObject=function(a){return new Bb(a)};var Cb=function(a){A.call(this,a);this.type="EllipsObject"};ba(A,Cb);Cb.prototype.draw=function(){if(this.visible&&this.alpha){M(this);za(f(this.x,this.y),this.h/2,this.fillColor,this.strokeColor,this.strokeWidth);
if(this.ondraw)this.ondraw();G()}};this.game.newEllipsObject=function(a){return new Cb(a)};var Z=function(a){A.call(this,a);this.type="TextObject";this.text=a.text||"TextObject";this.color=a.color||"";this.size=a.size||10;a.scale&&(this.size*=a.scale);this.font=a.font||"sans-serif";this.style=a.style||"";this.align="left";this.padding=a.padding||2;this.w=Db(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||!1;this.strokeWidthText=
a.strokeWidthText||!1;this.textDY=-this.size/7;a.positionC&&this.setPositionC(a.positionC)};ba(A,Z);Z.prototype.reStyle=function(a){this.text=a.text||this.text;this.color=a.color||this.color;this.size=a.size||this.size;this.font=a.font||this.font;this.style=a.style||this.style;this.padding=a.padding||this.padding;this.w=Db(this.text,this.style,this.size,this.font)+2*this.padding;this.h=this.size+2*this.padding;this.strokeColorText=a.strokeColorText||this.strokeColorText;this.strokeWidthText=a.strokeWidthText||
this.strokeWidthText;this.strokeColor=a.strokeColor||this.strokeColor;this.strokeWidth=a.strokeWidth||this.strokeWidth;this.fillColor=a.fillColor||this.fillColor;this.textDY=-this.size/7};Z.prototype.setText=function(a){this.text!=a&&this.reStyle({text:a})};Z.prototype.getText=function(){return this.text};Z.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;(this.fillColor||this.strokeColor)&&ya(f(this.x,this.y),B(this.w,this.h),
this.fillColor,this.strokeColor,this.strokeWidth);qa(f(this.x+this.padding,this.textDY+this.y+this.padding),this.text,this.color,this.size,this.font,this.style,this.align,this.strokeColorText,this.strokeWidthText);if(this.ondraw)this.ondraw();a&&G()}};Z.prototype.scale=function(a){this.reStyle({size:this.size*a})};Z.prototype.scaleC=function(a){var b=this.w,c=this.h;this.reStyle({size:this.size*a});this.move(f(-((this.w-b)/2),-((this.h-c)/2)))};Z.prototype.setSize=function(a){this.size!=a&&this.reStyle({size:a})};
Z.prototype.setSizeC=function(a){this.size!=a&&(this.reStyle({size:a}),this.move(f(-a/2,-a/2)))};var Db=function(a,b,c,d){var e=g.document.createElement("canvas").getContext("2d");e.font=b+c+"px "+d;return e.measureText(a).width};this.OOP.getTextWidth=function(a){return Db(a.text,a.style||"",a.size||10,a.font||"sans-serif")};this.game.newTextObject=function(a){return new Z(a)};var Q=function(a){A.call(this,a);this.type="PolygonObject";this.points=[];this.dX=this.dY=0;var b=this;a.points&&v(a.points,
function(a){b.addPoint(a)});this.pointColor=a.pointColor||!1};ba(A,Q);Q.prototype.addPoint=function(a){this.dY=this.dX=0;var b=this;this.y+a.y<this.y&&(this.dY=Math.abs(this.y+a.y-this.y),v(this.points,function(a){a.y+=b.dY}));this.x+a.x<this.x&&(this.dX=Math.abs(this.x+a.x-this.x),b=this,v(this.points,function(a){a.x+=b.dX}));this.points.push(f(a.x+this.dX,a.y+this.dY));this.h=this.w=0;b=this;v(this.points,function(a){b.h+=b.y+a.y>b.y+b.h?a.y-b.h:0;b.w+=b.x+a.x>b.x+b.w?a.x-b.w:0})};Q.prototype.delPoint=
function(a){var b,c=this.getPoints();this.clearPoints();var d=0;for(b=c.length;d<b;d+=1)d!=a&&this.addPoint(c[d])};Q.prototype.clearPoints=function(){this.points=[];this.count=0};Q.prototype.getPoints=function(){return this.points};Q.prototype.getCount=function(){return this.points.length};Q.prototype.getPoint=function(a){return this.points[a]};Q.prototype.scale=function(a){return!1};Q.prototype.drawDynamicBox=function(a){var b=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),b=!0;La(this.x,
this.y,this.points,this.fillColor,a||"yellow",2,"red");b&&G()};Q.prototype.getDynamicBox=function(){var a=[];if(this.angle){var b=this.getPosition(1);c=this;v(this.points,function(d){a.push(N(ta(d,f(c.x,c.y)),b,c.getAngle()))})}else{var c=this;v(this.points,function(b){a.push(ta(b,f(c.x,c.y)))})}return a};Q.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),a=!0;La(this.x,this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,
this.pointColor);if(this.ondraw)this.ondraw();a&&G()}};this.game.newPolygonObject=function(a){return new Q(a)};var ra=function(a){A.call(this,a);this.type="ImageObject";this.loaded=!1;this.file="";this.forOnLoad=a.onload||!1;dc(a.file,this,a.scale||1)};ba(A,ra);ra.prototype.draw=function(){if(this.visible&&this.alpha&&this.loaded){var a=!1;if(this.angle||1!=this.alpha||this.shadowColor||this.flip.x||this.flip.y)M(this),a=!0;ec(f(this.x,this.y),B(this.w,this.h),this.file);if(this.ondraw)this.ondraw();
a&&G()}};ra.prototype.simpleDraw=function(a){if(this.loaded){var b=!1;if(this.angle||1!=this.alpha||this.shadowColor)M(this),b=!0;ec(f(a.x,a.y),B(this.w,this.h),this.file);b&&G()}};ra.prototype.setImage=function(a,b){this.file!=a&&(u(k[a])?(this.file=a,b&&b()):(this.loaded=!1,this.origHeight=this.origWidth=0,this.forOnLoad=b||!1,dc(a,this)))};ra.prototype.getImage=function(){return this.file};ra.prototype.resize=function(a){if(!1!==a.w&&!1===a.h){var b=a.w/this.w;this.w=a.w;this.h*=b}else!1!==a.h&&
!1===a.w?(b=a.h/this.h,this.h=a.h,this.w*=b):!1!==a.w&&!1!==a.h&&(this.w=a.w,this.h=a.h)};this.game.newImageObject=function(a){return new ra(a)};var W=function(a){A.call(this,a);this.type="AnimationObject";this.frame=0;this.anim=a.animation;this.step=a.delay||10;this.toFrameStep=this.difStep=0;a.scale&&(this.w*=a.scale,this.h*=a.scale)};ba(A,W);W.prototype.draw=function(){if(this.visible&&this.alpha){var a=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y||this.shadowColor)M(this),a=!0;Eb(this.anim,
f(this.x,this.y),B(this.w,this.h),this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+1:0,this.difStep=0):this.difStep+=1;a&&G()}};W.prototype.drawFrames=function(a,b,c){if(this.visible&&this.alpha){if(this.frame<a||this.frame>b)this.frame=a;c=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y||this.shadowColor)M(this),c=!0;Eb(this.anim,f(this.x,this.y),B(this.w,this.h),this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?
(this.frame=this.frame<b?this.frame+1:a,this.difStep=0):this.difStep+=1;c&&G()}};W.prototype.drawFrame=function(a){if(this.visible&&this.alpha){var b=!1;if(this.angle||1!=this.alpha||this.flip.x||this.flip.y||this.shadowColor)M(this),b=!0;Eb(this.anim,f(this.x,this.y),B(this.w,this.h),a);if(this.ondraw)this.ondraw();b&&G()}};W.prototype.drawToFrame=function(a){if(this.visible&&this.alpha){if(this.frame<a)this.toFrameStep=1;else if(this.frame>a)this.toFrameStep=-1;else{this.drawFrame(a);return}this.drawFrame(this.frame);
if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+this.toFrameStep:0,this.difStep=0):this.difStep+=1}};W.prototype.drawReverFrames=function(a,b){if(this.visible&&this.alpha){this.drawFrame(this.frame);if(this.ondraw)this.ondraw();this.difStep>this.step?(this.frame<=a?this.toFrameStep=1:this.frame>=b&&(this.toFrameStep=-1),this.frame+=this.toFrameStep,this.difStep=0):this.difStep+=1}};W.prototype.setAnimation=function(a){a.id!=this.anim.id&&(this.frame=
0,this.anim=a)};W.prototype.getAnimation=function(){return this.anim};W.prototype.setDelay=function(a){this.step=0<a?a:this.step};W.prototype.getDelay=function(){return this.step};this.game.newAnimationObject=function(a){return new W(a)};var Wb=function(a){var b=!1;"RectObject"==a.type?b=q.game.newRectObject({}):"CircleObject"==a.type?b=q.game.newCircleObject({}):"RoundRectObject"==a.type?b=q.game.newRoundRectObject({}):"TextObject"==a.type?b=q.game.newTextObject({}):"EllipsObject"==a.type?b=q.game.newEllipsObject({}):
"ImageObject"==a.type?b=q.game.newImageObject({file:a.file}):"TriangleObject"==a.type?b=q.game.newTriangleObject({}):"AnimationObject"==a.type&&(b=q.game.newAnimationObject({animation:a.animation}));return b},vc=0,sa=function(a,b){this.file=a;this.loaded=!1;this.h=this.w=0;this.id=vc++;this.toLoad=[];var c=g.document.createElement("img"),d=this;c.onload=function(){d.loaded=!0;d.w=this.width;d.h=this.height;d.img=g.document.createElement("canvas");d.img.width=this.width;d.img.height=this.height;d.context=
d.img.getContext("2d");d.context.drawImage(this,0,0);d.toLoad.length&&v(d.toLoad,function(a){a.func(d.context,a.w,a.h,a.r)});b&&(d.onLoad=b,d.onLoad());z.load()};c.src=a;z.add()};sa.prototype.onContext=function(a){this.loaded?a(this.context,this.w,this.h,1):this.toLoad.push({w:this.w,h:this.h,r:1,func:a})};sa.prototype.getCanvas=function(){return this.img};var wc=0;sa.prototype.getAnimation=function(a,b,c,d,e){var l=function(a,b,c,d,e,l){this.id=wc++;this.image=a;this.x=b;this.y=c;this.w=d;this.h=
e;this.endFrame=this.r=l?l-1:0;this.frameCount=this.r+1};l.prototype={onContext:function(a){this.image.loaded?a(this.image.context,this.w,this.h,this.r):this.image.toLoad.push({w:this.w,h:this.h,r:this.r,func:a})},getImage:function(){return this.image},getCount:function(){return this.r}};return new l(this,a,b,c,d,e)};var Fb=function(a,b){this.loaded=!0;this.w=a;this.h=b;this.img=g.document.createElement("canvas");this.img.width=a;this.img.height=b;this.context=this.img.getContext("2d")};Fb.prototype.onContext=
sa.prototype.onContext;Fb.prototype.getAnimation=sa.prototype.getAnimation;this.tiles.newDrawImage=function(a,b){return new Fb(a,b)};this.tiles.newImage=function(a,b){return new sa(a,b)};this.tiles.newAnimation=function(a,b,c,d){return(new sa(a)).getAnimation(0,0,b,c,d)};var Eb=function(a,b,c,d){if(a&&a.image.loaded){var l=-e.x,f=-e.y;a.image.img&&h.drawImage(a.image.img,a.x+a.w*d,a.y,a.w,a.h,b.x+l,b.y+f,c.w,c.h)}},k={},dc=function(a,b,c){if(u(k[a])){b.loaded=!0;b.file=a;if(b.w&&!b.h){var d=b.w/k[a].w;
var e=b.w;var f=k[a].h*d}else!b.w&&b.h?(d=b.h/k[a].h,f=b.h,e=k[a].w*d):b.w&&b.h?(e=b.w,f=b.h):(e=k[a].w,f=k[a].h);c&&(e*=c,f*=c);b.w=e;b.h=f;b.forOnLoad&&b.forOnLoad()}else e=g.document.createElement("img"),e.onload=function(){k[a]={};k[a].loaded=!0;k[a].img=this;k[a].w=this.width;k[a].h=this.height;if(u(b)){b.loaded=!0;if(b.w&&!b.h){var d=b.w/k[a].w;var e=b.w;var f=k[a].h*d}else!b.w&&b.h?(d=b.h/k[a].h,f=b.h,e=k[a].w*d):b.w&&b.h?(e=b.w,f=b.h):(e=k[a].w,f=k[a].h);c&&(e*=c,f*=c);b.w=e;b.h=f;b.file=
a;b.forOnLoad&&b.forOnLoad()}z.load()},e.src=a,z.add()},ec=function(a,b,c){if(c){var d=-e.x,f=-e.y;k[c]&&h.drawImage(k[c].img,0,0,k[c].w,k[c].h,a.x+d,a.y+f,b.w,b.h)}},fc=function(a){this.type="Mesh";this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;var b=this;a.add&&v(a.add,function(a){b.add(a)});this.angle&&this.setAngle(this.angle)};fc.prototype={getCount:function(){return this.count},getObjects:function(){return this.objs},add:function(a){this.count+=1;this.objs.push(a);
a.offsetMesh=a.getPosition(1);a.turn(this.angle);a.setPositionC(f(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},del:function(a){var b=this;v(this.objs,function(c){c.id==a.id&&(b.objs.splice(void 0,1),b.count--)})},draw:function(a){v(this.objs,function(a){a.draw()})},move:function(a){this.x+=a.x||0;this.y+=a.y||0;var b=this;v(this.objs,function(a){a.setPositionC(f(b.x+a.offsetMesh.x,b.y+a.offsetMesh.y))})},turn:function(a){if(0!=a){this.angle%=360;this.angle+=a;var b=f(this.x,this.y),c=this;v(this.objs,
function(d){d.turn(a);d.setPositionC(N(f(c.x+d.offsetMesh.x,c.y+d.offsetMesh.y),b,c.angle))})}},setAngle:function(a){if(a!=this.angle){this.angle=a%=360;var b=f(this.x,this.y),c=this;v(this.objs,function(d){d.setAngle(a);d.setPositionC(N(f(c.x+d.offsetMesh.x,c.y+d.offsetMesh.y),b,c.angle))})}},setPosition:function(a){if(this.x!=a.x||this.y!=a.y){this.x=a.x||this.x;this.y=a.y||this.y;var b=this;v(this.objs,function(a){b.angle?a.setPositionC(N(f(b.x+a.offsetMesh.x,b.y+a.offsetMesh.y),f(b.x,b.y),b.angle)):
a.setPositionC(f(b.x+a.offsetMesh.x,b.y+a.offsetMesh.y))})}},isDynamicIntersect:function(a){if(3>a.length)return!1;var b=!1;v(this.objs,function(c){if(c.isDynamicIntersect(a))return b=c});return b},isStaticIntersect:function(a){var b=!1;v(this.objs,function(c){if(c.isStaticIntersect(a))return b=c});return b},isIntersect:function(a){var b=!1;v(this.objs,function(c){if(c.isIntersect(a))return b=c});return b}};this.game.newMesh=function(a){return new fc(a)};this.camera.setScale=function(a){};this.camera.circling=
function(a,b,c){u(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);e.x=a.x+b*Math.cos(x(this.circlingAnglePointJS));e.y=a.y+b*Math.sin(x(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?c:this.circlingAnglePointJS+c};this.camera.circlingC=function(a,b,c){u(this.circlingAnglePointJS)||(this.circlingAnglePointJS=c);e.x=-O+a.x+b*Math.cos(x(this.circlingAnglePointJS));e.y=-P+a.y+b*Math.sin(x(this.circlingAnglePointJS));this.circlingAnglePointJS=360<=this.circlingAnglePointJS?
c:this.circlingAnglePointJS+c};this.camera.motion=function(a,b,c){u(this.motionPercentPointJS)||(this.motionPercentPointJS=b);e.x=a.x+b.w*Math.cos(x(this.motionPercentPointJS));e.y=a.y+b.h*Math.sin(x(this.motionPercentPointJS));this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+c};this.camera.motionC=function(a,b,c){u(this.motionPercentPointJS)||(this.motionPercentPointJS=b);this.setPositionC(f(a.x+b.w*Math.cos(x(this.motionPercentPointJS)),a.y+b.h*Math.sin(x(this.motionPercentPointJS))));
this.motionPercentPointJS=360<=this.motionPercentPointJS?b:this.motionPercentPointJS+c};this.camera.follow=function(a){this.moveTimeC(a.getPositionC(),10)};this.camera.move=function(a){e.x+=a.x||0;e.y+=a.y||0};this.camera.moveTime=function(a,b){b=b||1;var c=f(e.x,e.y);this.move(f((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.moveTimeC=function(a,b){b=b||1;var c=f(e.x+O,e.y+P);this.move(f((a.x-c.x)/b,(a.y-c.y)/b))};this.camera.setPosition=function(a){vb(f(!1!==a.x?a.x:e.x,!1!==a.y?a.y:e.y))};this.camera.setPositionC=
function(a){vb(f(!1!==a.x?a.x-O:e.x,!1!==a.y?a.y-P:e.y))};this.camera.getPosition=function(a){return a?f(e.x+O,e.y+P):f(e.x,e.y)};this.camera.getPositionC=function(){return f(e.x+O,e.y+P)};this.camera.getStaticBox=function(){return{x:e.x,y:e.y,w:e.x+n,h:e.y+p}};this.camera.getDynamicBox=function(){return[f(e.x,e.y),f(e.x+n,e.y),f(e.x+n,e.y+p),f(e.x,e.y+p)]};var vb=function(a){e=f(a.x,a.y)},G=function(a){h.restore();h.globalAlpha=t.globalAlpha;h.fillStyle="black";h.strokeStyle="black";h.msImageSmoothingEnabled=
Ba;h.imageSmoothingEnabled=Ba},M=function(a,b){h.save();var c=a.getPositionC();a.angle&&(h.translate(-e.x+c.x,-e.y+c.y),h.rotate(x(a.angle)),h.translate(-c.x+e.x,-c.y+e.y));1!=a.alpha&&(h.globalAlpha=a.alpha);if(a.flip.x||a.flip.y)h.translate(-e.x+c.x,-e.y+c.y),h.scale(a.flip.x?-1:1,a.flip.y?-1:1),h.translate(-c.x+e.x,-c.y+e.y);a.shadowColor&&(h.shadowBlur=a.shadowBlur,h.shadowColor=a.shadowColor,h.shadowOffsetX=a.shadowX,h.shadowOffsetY=a.shadowY);if("EllipsObject"==a.type&&!b){c=a.w/2;var d=a.h/
2,l=f(-e.x+a.x,-e.y+a.y);h.translate(l.x,l.y);h.scale(c/d,1);h.translate(-l.x,-l.y)}};this.system.setContextSettings=function(a){h.save();for(var b in a)h[b]=a[b]};this.system.defaultSettings=function(){G()};this.game.clear=function(){h.clearRect(0,0,n,p)};this.game.fill=function(a){h.fillStyle=a;h.fillRect(0,0,n,p)};var La=function(a,b,c,d,l,g,k){if(!(3>c.length)){if(d&&!(3>c.length)){h.fillStyle=d;d=-e.x+a;var m=-e.y+b;var n;h.beginPath();h.moveTo(d+c[0].x,m+c[0].y);for(n=1;n<c.length;n+=1)h.lineTo(d+
c[n].x,m+c[n].y);h.closePath();h.fill()}for(d=0;d<c.length;d+=1)m=d+1<c.length?d+1:0,l&&aa(ta(c[d],f(a,b)),ta(c[m],f(a,b)),l,g),k&&hb(ta(c[d],f(a,b)),k)}},R=function(a){a.x||(a.x=0);a.y||(a.y=0);a.w||(a.w=0);a.h||(a.h=0)};this.brush.drawPolygon=function(a){var b=a.points||[],c=a.fillColor||!1,d=a.strokeColor||!1,f=a.strokeWidth||1;a=a.pointColor||!1;if(!(3>b.length)){if(c&&!(3>b.length)){h.fillStyle=c;c=-e.x;var g=-e.y;var k;h.beginPath();h.moveTo(c+b[0].x,g+b[0].y);for(k=1;k<b.length;k+=1)h.lineTo(c+
b[k].x,g+b[k].y);h.closePath();h.fill()}for(c=0;c<b.length;c+=1)g=c+1<b.length?c+1:0,d&&aa(b[c],b[g],d,f),a&&hb(b[c],a)}};this.brush.drawTriangle=function(a){R(a);if(a.x+a.w<e.x||a.x>e.x+n||a.y+a.h<e.y||a.y>e.y+p)return!1;La(a.x,a.y,[f(a.w/2,0),f(a.w,a.h),f(0,a.h)],a.fillColor,a.strokeColor,a.strokeWidth)};this.brush.drawTriangleS=function(a){R(a);if(0>a.x+a.w||a.x>n||0>a.y+a.h||a.y>p)return!1;La(e.x+a.x,e.y+a.y,[f(a.w/2,0),f(a.w,a.h),f(0,a.h)],a.fillColor,a.strokeColor,a.strokeWidth)};var qa=function(a,
b,c,d,f,g,k,m,n){h.textAlign=k;h.lineWidth=n;h.font=(g?g+" ":"")+d+"px "+f;d=-e.x;f=-e.y;c&&(h.fillStyle=c,h.fillText(b,d+a.x,f+a.y));m&&(h.strokeStyle=m,h.strokeText(b,d+a.x,f+a.y))};this.brush.drawMultiText=function(a){var b,c=a.text.split("\n");for(b=0;b<c.length;b+=1)qa(f(a.x,a.y+a.size*b),c[b],a.color||t.fillStyle,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawMultiTextS=function(a){var b,c=a.text.split("\n"),d=a.size||10;for(b=0;b<c.length;b+=
1)qa(f(a.x+e.x,a.y+e.y+d*b),c[b],a.color||t.fillStyle,d||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawText=function(a){qa(f(a.x||0,a.y||0),a.text,a.color||!1,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawTextS=function(a){qa(f((a.x||0)+e.x,(a.y||0)+e.y),a.text,a.color||t.fillStyle,a.size||10,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)};this.brush.drawTextLines=
function(a){if(a.lines){var b,c=a.size||10;for(b=0;b<a.lines.length;b+=1)qa(f(a.x,a.y+c*b),a.lines[b],a.color||t.fillStyle,c,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};this.brush.drawTextLinesS=function(a){if(a.lines){var b,c=a.size||10;for(b=0;b<a.lines.length;b+=1)qa(f(a.x+e.x,a.y+e.y+c*b),a.lines[b],a.color||t.fillStyle,c,a.font||t.font,a.style||!1,a.align||"left",a.strokeColor||!1,a.strokeWidth||2)}};var cc=function(a,b,c){aa(f(a.x-b,a.y),f(a.x+b,a.y),c,2);
aa(f(a.x,a.y-b),f(a.x,a.y+b),c,2)},ya=function(a,b,c,d,f){h.fillStyle=c;h.strokeStyle=d;h.lineWidth=f;d=-e.x+(f?f/2:0);var l=-e.y+(f?f/2:0);c&&h.fillRect(a.x+d,a.y+l,b.w,b.h);f&&h.strokeRect(a.x+d,a.y+l,b.w,b.h)};this.brush.drawRect=function(a){R(a);if(a.x+a.w<e.x||a.x>e.x+n||a.y+a.h<e.y||a.y>e.y+p)return!1;ya(f(a.x,a.y),B(a.w,a.h),a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};this.brush.drawRectS=function(a){R(a);if(0>a.x+a.w||a.x>n||0>a.y+a.h||a.y>p)return!1;ya(f(a.x+e.x,a.y+
e.y),B(a.w,a.h),a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};var hb=function(a,b){(h.fillStyle=b)&&h.fillRect(-e.x+a.x-1,-e.y+a.y-1,2,2)};this.brush.drawPoint=function(a){R(a);if(a.x<e.x||a.x>e.x+n||a.y<e.y||a.y>e.y+p)return!1;hb(f(a.x,a.y),a.fillColor||!1)};this.brush.drawPointS=function(a){R(a);if(0>a.x||a.x>n||0>a.y||a.y>p)return!1;hb(f(a.x+e.x,a.y+e.y),a.fillColor||!1)};var Ab=function(a,b,c,d,f,g){h.fillStyle=d;h.strokeStyle=f;h.lineWidth=g;f=-e.x+a.x+(g?g/2:0);a=-e.y+a.y+
(g?g/2:0);h.beginPath();h.moveTo(f+c,a);h.lineTo(f+b.w-c,a);h.quadraticCurveTo(f+b.w,a,f+b.w,a+c);h.lineTo(f+b.w,a+b.h-c);h.quadraticCurveTo(f+b.w,a+b.h,f+b.w-c,a+b.h);h.lineTo(f+c,a+b.h);h.quadraticCurveTo(f,a+b.h,f,a+b.h-c);h.lineTo(f,a+c);h.quadraticCurveTo(f,a,f+c,a);h.closePath();d&&h.fill();g&&h.stroke()};this.brush.drawRoundRect=function(a){R(a);if(a.x+a.w<e.x||a.x>e.x+n||a.y+a.h<e.y||a.y>e.y+p)return!1;Ab(f(a.x,a.y),B(a.w,a.h),a.radius||2,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||
!1)};this.brush.drawRoundRectS=function(a){R(a);if(0>a.x+a.w||a.x>n||0>a.y+a.h||a.y>p)return!1;Ab(f(e.x+a.x,e.y+a.y),B(a.w,a.h),a.radius||2,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};var za=function(a,b,c,d,f){h.fillStyle=c;h.strokeStyle=d;h.lineWidth=f;d=-e.x+b+(f?f/2:0);var g=-e.y+b+(f?f/2:0);h.beginPath();h.arc(a.x+d,a.y+g,b,0,2*Math.PI,!0);h.closePath();c&&h.fill();f&&h.stroke()};this.brush.drawCircle=function(a){R(a);var b=2*a.radius;if(a.x+b<e.x||a.x>e.x+n||a.y+b<e.y||
a.y>e.y+p)return!1;za(f(a.x,a.y),a.radius,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};this.brush.drawCircleS=function(a){R(a);var b=2*a.radius;if(0>a.x+b||a.x>n||0>a.y+b||a.y>p)return!1;za(f(a.x+e.x,a.y+e.y),a.radius,a.fillColor||!1,a.strokeColor||t.strokeStyle,a.strokeWidth||!1)};var aa=function(a,b,c,d){h.strokeStyle=c;h.lineWidth=d;c=-e.x;d=-e.y;h.beginPath();h.moveTo(c+a.x,d+a.y);h.lineTo(c+b.x,d+b.y);h.closePath();h.stroke()};this.brush.drawLineAngle=function(a){var b=N(f(a.x+
a.length,a.y),f(a.x,a.y),a.angle);aa(f(a.x,a.y),f(b.x,b.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAngleS=function(a){var b=N(f(e.x+a.x+a.length,e.y+a.y),f(e.x+a.x,e.y+a.y),a.angle);aa(f(e.x+a.x,e.y+a.y),f(b.x,b.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLine=function(a){aa(f(a.x1,a.y1),f(a.x1+a.x2,a.y1+a.y2),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineS=function(a){aa(f(e.x+a.x1,e.y+a.y1),f(e.x+a.x2,e.y+a.y2),a.strokeColor||
t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineA=function(a){aa(f(a.x1,a.y1),f(a.x2,a.y2),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawLineAS=function(a){aa(f(a.x1+e.x,a.y1+e.y),f(a.x2+e.x,a.y2+e.y),a.strokeColor||t.strokeStyle,a.strokeWidth||1)};this.brush.drawEllips=function(a){R(a);if(a.x+a.w<e.x||a.x>e.x+n||a.y+a.h<e.y||a.y>e.y+p)return!1;var b=a.w/2,c=a.h/2,d=f(-e.x+a.x,-e.y+a.y);h.save();h.translate(d.x,d.y);h.scale(b/c,1);h.translate(-d.x,-d.y);za(f(a.x,a.y),c,a.fillColor,
a.strokeColor,a.strokeWidth);h.restore()};this.brush.drawEllipsS=function(a){R(a);if(0>a.x+a.w||a.x>n||0>a.y+a.h||a.y>p)return!1;var b=a.w/2,c=a.h/2,d=f(a.x,a.y);h.save();h.translate(d.x,d.y);h.scale(b/c,1);h.translate(-d.x,-d.y);za(f(e.x+a.x,e.y+a.y),c,a.fillColor,a.strokeColor,a.strokeWidth);h.restore()};this.brush.drawImageS=function(a){if(a.file)if(u(k[a.file])){if(k[a.file].loaded){var b=a.x||0,c=a.y||0;if(a.w&&!a.h){var d=a.w/k[a.file].w;var e=a.w;var f=k[a.file].h*d}else!a.w&&a.h?(d=a.h/k[a.file].h,
f=a.h,e=k[a.file].w*d):a.w&&a.h?(e=a.w,f=a.h):(e=k[a.file].w,f=k[a.file].h);a.scale&&(e*=a.scale,f*=a.scale);if(0>b+e||b>n||0>c+f||c>p)return!1;h.drawImage(k[a.file].img,0,0,k[a.file].w,k[a.file].h,b,c,e,f)}}else k[a.file]={loaded:!1},b=g.document.createElement("img"),b.onload=function(){k[a.file].loaded=!0;k[a.file].img=this;k[a.file].w=this.width;k[a.file].h=this.height;z.load()},b.src=a.file,z.add()};this.brush.drawImage=function(a){if(a.file)if(u(k[a.file])){if(k[a.file].loaded){var b=a.x||0,
c=a.y||0;if(a.w&&!a.h){var d=a.w/k[a.file].w;var f=a.w;var m=k[a.file].h*d}else!a.w&&a.h?(d=a.h/k[a.file].h,m=a.h,f=k[a.file].w*d):a.w&&a.h?(f=a.w,m=a.h):(f=k[a.file].w,m=k[a.file].h);a.scale&&(f*=a.scale,m*=a.scale);if(b+f<e.x||b>e.x+n||c+m<e.y||c>e.y+p)return!1;h.drawImage(k[a.file].img,0,0,k[a.file].w,k[a.file].h,-e.x+b,-e.y+c,f,m)}}else k[a.file]={},k[a.file].loaded=!1,b=g.document.createElement("img"),b.onload=function(){k[a.file].loaded=!0;k[a.file].img=this;k[a.file].w=this.width;k[a.file].h=
this.height;z.load()},b.src=a.file,z.add()};this.brush.onContext=function(a){a(h)};this.brush.getPixelColor=function(a,b){var c=h.getImageData(a,b,1,1).data;return"rgb("+c[0]+", "+c[1]+", "+c[2]+")"};this.brush.setPixelColor=function(a,b,c){var d=h.createImageData(1,1);d.data[0]=c.r||d.data[0];d.data[1]=c.g||d.data[1];d.data[2]=c.b||d.data[2];d.data[3]=c.a||255;h.putImageData(d,a,b)};this.brush.onPixel=function(a,b,c){var d=h.getImageData(a,b,1,1),e={r:d.data[0],g:d.data[1],b:d.data[2],a:d.data[3]?
d.data[3]:255};c(e);d.data[0]=e.r;d.data[1]=e.g;d.data[2]=e.b;d.data[3]=e.a;h.putImageData(d,a,b)};this.brush.onPixels=function(a,b,c,d,e){c=h.getImageData(a,b,c,d);var f;d=0;for(f=c.data.length;d<f;d+=4){var g={r:c.data[d],g:c.data[d+1],b:c.data[d+2],a:c.data[d+3]?c.data[d+3]:255};e(g);c.data[d]=g.r;c.data[d+1]=g.g;c.data[d+2]=g.b;c.data[d+3]=g.a}h.putImageData(c,a,b)};this.brush.onRawPixels=function(a,b,c,d,e){c=h.getImageData(a,b,c,d);e(c.data,c.data.length);h.putImageData(c,a,b)};var S=g.AudioContext||
g.webkitAudioContext||!1;(S=S?new S:!1)&&S.listener.setPosition(0,0,0);var T=function(a,b){S||U('module "wAudio" is not supported! use a "audio"');this.vol=b&&1>=b&&0<b?b:1;this.loadPLay=this.nextPlay=this.loaded=this.playing=!1;this.pausedTime=this.duration=this.startTime=0;var c=this,d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType="arraybuffer";d.onload=function(a){S.decodeAudioData(this.response,function(a){c.wABuffer=a;c.duration=c.wABuffer.duration;c.wAGain=S.createGain();c.wAGain.gain.value=
c.vol;c.wAPanner=S.createPanner();c.wAPanner.setPosition(0,0,1);c.wAPanner.panningModel="equalpower";z.load();c.loaded=!0;c.loadPlay&&c.replay()},function(a){U("error in wAudio.newAudio : error decoding file",a)})};a?d.send():U("error in wAudio.newAudio : Where is file?");z.add()};T.prototype.play=function(a){if(!this.loaded)this.loadPlay=!0;else if(!this.playing){this.playing=!0;this.wASource=S.createBufferSource();this.wASource.buffer=this.wABuffer;this.wAListener=S.destination;this.wASource.connect(this.wAGain);
this.wAGain.connect(this.wAPanner);this.wAPanner.connect(this.wAListener);this.wASource.start(0,this.pausedTime,this.duration);this.startTime=S.currentTime;var b=this;this.wASource.onended=function(){b.playing=!1;b.startTime=0;b.pausedTime=0;b.nextPlay&&b.nextPlay.replay()}}};T.prototype.replay=function(a){this.loaded?(this.stop(),this.play()):this.loadPlay=!0};T.prototype.stop=function(){this.pause();this.pausedTime=this.startTime=0};T.prototype.pause=function(){if(this.playing){this.pausedTime=
this.getProgress();this.playing=!1;this.wASource.stop(0);var a=this;this.wASource.onended=function(){a.playing=!1}}};T.prototype.getProgress=function(){return this.playing?S.currentTime-this.startTime+this.pausedTime:this.pausedTime};T.prototype.playPause=function(){this.playing?this.pause():this.play()};T.prototype.setNextPlay=function(a){this.nextPlay=a};T.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.wAGain.gain.value=this.vol};T.prototype.getVolume=function(){return this.vol};
T.prototype.setSide=function(a){this.side=a;this.wAPanner&&this.wAPanner.setPosition(this.side,0,1-Math.abs(this.side))};T.prototype.getSide=function(){return this.side};this.wAudio.newAudio=function(a,b){return new T(a,b)};var da=function(a,b){var c,d=g.document.createElement("audio");if("string"==typeof a){var e=g.document.createElement("source");e.src=a;d.appendChild(e)}else{var f=0;for(c=a.length;f<c;f+=1)e=g.document.createElement("source"),e.src=a[f],d.appendChild(e)}this.vol=b&&1>=b&&0<b?b:
1;this.playing=0;this.audio=d;this.nextPlay=this.loaded=!1;d.volume=this.vol;var h=this;d.onloadeddata=function(){h.loaded=!0;z.load()};d.onended=function(){h.playing=!1;h.nextPlay&&h.nextPlay.play()};d.load();z.add()};da.prototype.play=function(a){this.playing||(a&&(this.vol=a&&1>=a&&0<a?a:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.play())};da.prototype.replay=function(a){a&&this.setVolume(a);this.playing=!0;this.audio.currentTime=0;this.audio.play()};da.prototype.stop=function(){this.playing&&
(this.playing=!1,this.audio.pause(),this.audio.currentTime=0)};da.prototype.pause=function(){this.playing&&(this.playing=!1,this.audio.pause())};da.prototype.playPause=function(){this.playing?this.pause():this.play()};da.prototype.setNextPlay=function(a){this.nextPlay=a};da.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.audio.volume=this.vol};da.prototype.getVolume=function(){return this.vol};this.audio.newAudio=function(a,b){return new da(a,b)};var ib=[];this.zList.add=function(a){ib.push(a)};
this.zList.init=function(a){OOP.forArr(a,function(a){q.zList.add(a)})};this.zList.update=function(){ib.sort(function(a,b){return a.y+a.h-(b.y+b.h)})};this.zList.draw=function(a){OOP.drawArr(ib,a)};this.zList.del=function(a){OOP.delObject(ib,a)};var z={count:0,loaded:0,errored:0,add:function(){this.count+=1},load:function(){this.loaded+=1},error:function(){this.errored+=1}};this.resources.isLoaded=function(){return z.count==z.loaded};this.resources.getProgress=function(){return Math.ceil(z.loaded/
z.count*100)};this.levels.forStringArray=function(a,b){var c=a.offset||f(0,0);v(a.source,function(d,e){v(d,function(d,f){" "!=d&&b(d,c.x+a.w*f,c.y+a.h*e,a.w,a.h)})})};var xc=function(a){"ImageObject"==a.type&&"undefined"!=typeof RESOURCES&&a.resFile&&(a.file=RESOURCES[a.resFile]);"AnimationObject"==a.type&&"undefined"!=typeof ANIMATIONS&&a.animId&&(a.anim=ANIMATIONS[a.animId]);var b=Wb(a);b.name="";E(a,function(a,d){"id"!=d&&(b[d]=a)});return b},gc=function(a,b){var c={settings:{},objects:[]};a=JSON.parse(a);
c.settings=a.settings;v(a.objects,function(a){var d=xc(a);d.name=a.name;b&&b(d);c.objects.push(d)});return c},hc=function(a,b,c){var d=[],e={};if(a&&"json"==b){b=gc(a,c);d=b.objects;e=b.settings;var f=a}this.backgroundColor=e.backgroundColor?e.backgroundColor:!1;this.reload=function(){d=gc(f)};this.clear=function(){Vb(d)};this.add=function(a){d.push(a)};this.del=function(a){v(d,function(b,c){if(a.id==b.id)return d.splice(c,1),"break"})};this.delById=function(a){d.splice(a,1)};this.getObjects=function(){return d};
this.getObjectByName=function(a){var b;var c=0;for(b=d.length;c<b;c+=1)if(d[c].name==a)return d[c];return!1};this.getObjectById=function(a){var b;var c=0;for(b=d.length;c<b;c+=1)if(d[c].id==a)return d[c];return!1};this.draw=function(a){this.backgroundColor&&q.game.fill(this.backgroundColor);v(d,function(b){a&&a(b);b.draw()})};this.getLevelAsJSON=function(a,b){var c='{"settings":'+JSON.stringify({backgroundColor:this.backgroundColor})+',"objects":[';if(!d.length)return c+"]}";v(d,function(d,e){a&&
a(d);c+="{";E(d,function(a,b){"function"!=typeof a&&(c+='"'+b+'":'+JSON.stringify(a)+",")});c=c.substr(0,c.length-1)+"},";b&&b(d)});c=c.substr(0,c.length-1);return c+"]}"}};this.levels.newLevelFromJSON=function(a,b){return new hc(a,"json",b||!1)};this.levels.newEmptyLevel=function(a){return new hc(!1)};var ic=0,jc=0,Gb=0,kc=!1;this.system.initFPSCheck=function(){kc||(kc=!0,m.addEvent("postLoop","fpsCheckUpdate",function(){Gb+=1;1E3<=K-jc&&(ic=Gb,Gb=0,jc=K)}))};this.system.getFPS=function(){return ic};
this.OOP.newRever=function(a,b,c){var d=function(a,b,c){this.min=a;this.max=b;this.step=c;this.value=a;this.to=c};d.prototype={update:function(){var a=this.value;this.value<=this.min?this.to=this.step:this.value>=this.max&&(this.to=-this.step);this.value+=this.to;return a},getValue:function(){return this.value},setValue:function(a){this.value=parseFloat(a)},setStep:function(a){this.step=a},getStep:function(){return this.step}};return new d(a,b,c)};var lc={};this.OOP.once=function(a,b){lc[a]||(lc[a]=
!0,b())};this.OOP.newTimer=function(a,b){if(0>=a)return ja("error in system.newTimer : variable < 0, Timer is not created");var c={time:0<a?a:1E3,func:b,startTime:!1,ending:!1,start:function(){this.ending||this.startTime||(this.startTime=K)},run:function(){!this.ending&&this.startTime&&K-this.startTime>=this.time&&(this.func(),this.ending=!0)},end:function(){this.ending||(this.ending=!0,this.func())},restart:function(a){this.startTime||this.start();if(this.ending){if(a&&0>=a)return ja("error in Timer.restart : variable < 0");
a&&(this.time=a);this.ending=!1;this.startTime=K}},stop:function(){this.ending||(this.ending=!0)}};m.addEvent("postLoop","timer"+ca(-100,100)*ca(-100,100)+K,function(){c.run()});return c};this.memory.local={storage:g.localStorage,clear:function(){this.storage.clear()},save:function(a,b){this.storage.setItem(a,b)},saveAsObject:function(a,b){var c=JSON.stringify(b);this.storage.setItem(a,c)},loadAsObject:function(a){return JSON.parse(this.storage.getItem(a))},load:function(a){return this.storage.getItem(a)},
loadAsNumber:function(a){return parseFloat(this.storage.getItem(a))}};this.memory.temp={values:{},save:function(a,b){this.values[a]=b},load:function(a){return this.values[a]},loadAsNumber:function(a){return parseFloat(this.values[a])}};g.onload=function(){if(h){for(var a in t)h[a]=t[a];h.save()}m.runEvent("onload");m.loaded=!0;"function"===typeof POINTJS_USER_ONLOAD&&POINTJS_USER_ONLOAD();return!1};g.onblur=function(){if(ka)return m.runEvent("gameBlur"),!1};g.onfocus=function(){if(!ka)return g.document.activeElement.blur(),
g.focus(),m.runEvent("gameFocus"),!1};g.onresize=function(){m.runEvent("gameResize");h&&(h.textBaseline=t.textBaseline);return!1};g.onclick=function(){g.document.activeElement.blur();g.focus()};if("undefined"!==typeof POINTJS_LOADED_DOM_IGNORE)g.onload()};
</script>
					<script>// объявляем движок
var pjs = new PointJS(640, 480, {
	backgroundColor : 'white' // optional
});
// растягиваем игру на всю страницу
pjs.system.initFullPage(); // for Full Page mode
// системные функции для сокращения
var log    = pjs.system.log;     // log = console.log;
var game   = pjs.game;           // Game Manager
var point  = pjs.vector.point;   // Constructor for Point
var camera = pjs.camera;         // Camera Manager
var brush  = pjs.brush;          // Brush, used for simple drawing
var OOP    = pjs.OOP;            // Objects manager
var math   = pjs.math;           // More Math-methods
var levels = pjs.levels;         // Levels manager
// включим мышь
var mouse = pjs.mouseControl.initControl();
// получим новые ширину и высоту экрана
var width  = game.getWH().w; // width of scene viewport
var height = game.getWH().h; // height of scene viewport
// заголовок
pjs.system.setTitle('404'); // Set Title for Tab or Window
// отключим показ кусора (заменим своим)
mouse.setVisible(false);
// переменная для счета
var score = 0;
// при изменении размера перезагрузим игру
window.onresize = function () {
  location.reload();
};
// этой функцией будем прогонять зависимые от высоты экрана значения
var i = function (num) {
  return num * (height/260);
};
</script>
<script>// Объявляем игровой цикл
game.newLoopFromConstructor('Menu', function () {
  // Для меню мне требуется создать красивый фон в стиле DNS 
  var bg = game.newImageObject({
    x : 0, y : 0, // позиция
    file : 'dns_logo.jpeg', // файл фона
    w : width, // ширину установим
    h : height,
    alpha : 0.8 // немного блеклый
  });
  // объявим функция входа в игровой цикл
  this.entry = function () {
    var div, _s;
    if (score) {
      div = pjs.system.newDOM('div', true);
      _s = div.style; // ссылка на стили
      _s.height = _s.width = '100%'; // установили ширину и высоту HTML блока
      _s.backgroundColor = 'white'; // заливка
      _s.cursor = 'default'; // курсор
      if (score == 1) { // если выиграл
        div.innerHTML = `
          <table width="100%" height="100%"><tr><td valign="middle" align="center">
            <b>Вот так мы оставляем на прилавках только качественный продукт!</b> <br> <br>
            <a target="_parent" href="/">Перейти в магазин и попробовать лично</a> <br>
            <a href="#" onclick="location.reload();">Сыграть еще раз</a>
          </td></tr></table>`;
      } else if (score == -1) { // если проиграл
        div.innerHTML = `
          <table width="100%" height="100%"><tr><td valign="middle" align="center">
            <b>Задача - убрать только сломанные компьютеры!</b> <br> <br>
            <a href="#" onclick="location.reload();">Я понял, запускай!</a> <br>
            <a target="_parent" href="/">Перейти в магазин и попробовать лично</a>
          </td></tr></table>`;
      }
    }
  };
  this.update = function () {
    // запомним на всякий случай позицию курсора
    var mp = mouse.getPosition();
    // при наведении мыши сделаем ярче
    if (mp.x > 10 && mp.x < width - 10 && mp.y > 10 && mp.y < height - 10) bg.setAlpha(1);
    else bg.setAlpha(0.5);
    // по клику перейдем в игру
    if (mouse.isPress('LEFT')) {
      game.setLoop('Game');
    }
    // отрисуем фон
    bg.draw();
    // отрисуем свой курсор
    brush.drawImage({
      x : mp.x - 10, y : mp.y - 10, // 10 - смещение картинки из-за обрамления
      file : 'menu_cursor.png'
    });
  };
});
// Запускаем игру на текущем игровом цикле
game.startLoop('Menu');
</script>
<script>game.newLoopFromConstructor('Game', function () {
  // создадим полки, по которым будут плыть компьютеры
  var bg = game.newImageObject({
    x : 0, y : 0, // позиция
    file : 'bg_game.jpg', // файл фона
    w : width, // ширину установим, высота подгонится сама,
    h : height
  });
  // массив с количеством компьютеров на полочках (для инициализации)
  var cntShelf;
  var cntRIP = 0;
  // уровни полок по оси Y
  var shelf = {
    1 : i(15),  // верхняя полка
    2 : i(86),  // средняя
    3 : i(160)  // нижняя
  };
  // скорости движения на полках  
  var shelfSpeed = {
    1 : math.random(2, 8),
    2 : math.random(2, 8),
    3 : math.random(2, 8)
  };
  var createLaptop = function (s) { // агрументом передаем полку
    var rnd = s ? s : math.random(1, 3); // выбираем полку (случайно) или из агрумента
    var rip = math.random(1, 5) == 5; // выберем тип компьютера (случайно)
    // увеличим количество компьютеров, которые надо убрать (для инициализации)
    if (!s && rip) cntRIP++;
    return game.newImageObject({
      y : shelf[rnd], // установим на выбранную полку
      h : i(50), // выота компьютера
      file : !rip ? 'laptop.png' : 'laptop_rip.png', // выбираем нужный спрайт
  
      userData : { // дополнительные данные (нестандартные)
        shelf : rnd, // полка
        rip : rip // тип компьютера
      },
      onload : function () { // отпозиционируем после загрузки по оси X 
        var dist = 10; // дистанция между компьютерами
        this.x = -cntShelf[rnd] * (this.w + dist); // рссчитываем позицию
        cntShelf[rnd]++; // увеличиваем количество на выбранной полке
      }
    });    
  };
  // объекты для "отстрела"
  var cells = []; // это массив
  var fog = 0; // степень прозрачности после тумана после выстрела
  var scale = 1; // степень деформации прицела
  // при входе в игровой цикл установим первичные данные
  this.entry = function () {
    score = 0; // сбросим счет
    // сбросим количества компьютеров
    cntShelf = {
      1 : 0,
      2 : 0,
      3 : 0
    };
    // заполнение массива
    OOP.fillArr(cells, math.random(20, 90), function () {
      return createLaptop(); // вернем в массив только что созданный объект
    });
  };
	this.update = function () {
	  var dt = game.getDT(30); // для плавного движения возьмем дельту и поделим на 100
    // запомним на всякий случай позицию курсора
    var mp = mouse.getPosition();
    // запомним так же скорость мыши
    var mps = Math.max(mouse.getSpeed().x, mouse.getSpeed().y);
    // запомним состояние нажатия (true/false) для текущего кадра
    var fire = mouse.isPress('LEFT');
    // имитируем выстрел
    if (fire) {
      fog = 1;
      scale = 1.5;
    }
    // рисуем полочки
    bg.draw();
    // рисуем объекты
    OOP.forArr(cells, function (c, i) {
      var rnd;
      c.draw();
      c.move(point(shelfSpeed[c.shelf] * dt, 0)); // двигаем по оси X
      // если объект ушел за пределы видимости, меняем его позицию по X
      if (c.x > width) {
        c.x = -c.w * cntShelf[c.shelf];
      }
      // если выстрел, проверим попадание
      if (fire) {
        // если курсор попадает в статический бокс объекта BBOX
        if (mouse.isInStatic(c.getStaticBox())) {
          // если компьютер с синим экраном - то увеличиваем счет
          if (c.rip) {
            score++;
            // если мы набрали нужное количество очков
            if (score >= cntRIP) {
              score = 1;
              game.setLoop('Menu');
            }
          } else { // а иначе выкидываем в меню из-за неправильного выбора
            score = -1;
            game.setLoop('Menu');
            return;
          }
          cells.splice(i, 1);
          cells.push(createLaptop()); // добавляем еще новый компьютер
          return;
        }
      }
    });
    // рисуем прицел
    brush.drawImage({
      x : mp.x - i(50) * scale, y : mp.y - i(50) * scale, // 10 - смещение картинки из-за обрамления
      w : i(100) * scale, h : i(100) * scale, // размеры установим фактические
      file : 'cell.png'
    });
    // рисуем счет
    brush.drawText({
      text : 'Убрано: ' + score + '/' + cntRIP,
      color : 'black',
      size : i(15),
      font : 'serif'
    });
    // если есть туман, рисуем его и меняем прозрачность
    if (fog > 0) {
      brush.drawRect({
        w : width, h : height, // закрываем всё
        fillColor : 'rgba(255, 255, 255, '+fog+')'
      });
      fog -= 0.1; // прозрачность
      scale -= 0.05; // степерь деформации прицела
    }
	};
});
</script>
</body> 			
</html>
